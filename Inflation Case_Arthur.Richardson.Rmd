---
title: 'Inflation: Finding the Correlations to Build a Machine Learning Model for Backtesting and Forecasting'
author: "Arthur 'Rich' Richardson"
date: "9/5/2022"
output: 
  html_document:
    toc: yes
    pdf_document:
    keep_tex: true
    classoption: a4paper
    fig_height: 5
    fig_width: 5
    fig_caption: true
    toc_float:
      collapsed: false
      smooth_scroll: false
    theme: spacelab
    df_print: paged
mainfont: Times New Roman
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
&nbsp; 

<center> This Project is dedicated to my two daughters. </center>
<center> *__I love you both equally__*, from the furthest Sun our Universe will ever know and back! </center>
<center> *__Love, Dad__*. </center>

&nbsp; 

\newpage

## Installation: 

**Note:** *Due to known loading issues, load the following package(s) dependency(ies), if needed*

```{r warning = FALSE, message= FALSE, eval=FALSE}
install.packages("hms", dependencies = TRUE)
install.packages("gtable", dependencies = TRUE)
install.packages("hexbin", dependencies = TRUE)
install.packages("readr", dependencies=TRUE, INSTALL_opts = c('--no-lock'))
install.packages("caret", dependencies = TRUE)
install.packages("data.table", dependencies = TRUE)
install.packages("tidyverse", dependencies = TRUE)
install.packages("Rcolorbrewer", dependencies = TRUE)
install.packages("gt", dependencies = TRUE)
install.packages("lubridate", dependencies = TRUE)
install.packages("highcharter", dependencies = TRUE)
install.packages("ggpmisc", dependencies = TRUE)
install.packages("janitor", dependencies = TRUE)
install.packages("scales", dependencies = TRUE)
install.packages("quantmod", dependencies = TRUE)
install.packages("forecast", dependencies = TRUE)
install.packages("ggfortify", dependencies = TRUE)
```

Load the following Library(ies)

```{r warning = FALSE, message= FALSE}
library(tidyverse)
library(caret)
library(data.table)
library(RColorBrewer)
library(rmarkdown)
library(dslabs)
library(gtable)
library(hexbin)
library(gt)
library(dplyr)
library(ggpmisc)
library(gridExtra)
library(janitor)
library(lubridate)
library(highcharter)
library(viridisLite)
library(broom)
library(scales)
library(xfun)
library(htmltools)
library(mime)
library(quantmod)
library(forecast)
library(tseries)
library(ggfortify)
library(png)
library(jpeg)
library(gtsummary)
library(latexpdf)
library(tinytex)
```
   
For Lower Bandwidth/ RAM recommend adjusting the timeout settings 
   
```{r warning = FALSE, message= FALSE, results = "hide"}
options(timeout = 320)
```
   
   Depending on your RAM, to free up unused memory, recommend using
   
```{r warning = FALSE, message= FALSE, results = "hide"}
gc()
```

   Required data sets are embedded for download:
   
```{r warning = FALSE, message= FALSE}
xfun::pkg_load2(c("htmltools", "mime")) 
xfun::embed_files(c('SP5001913.csv', 
                    'US CPI.csv', 'Inflation_Rate_Fed_Rate_1913_2017 - Sheet1.csv'))
```

**Note:** For S&P original file see footnotes. [^1]  

[^1]: ***You can download the S&P 500 file from*** (https://datahub.io/core/s-and-p-500/r/data.csv)

   Load S&P 500 Dataset. 
   
**Note:** *The document is be embedded for download. Insert your file path of where you saved the document* 
   
```{r warning = FALSE, message= FALSE, results = "hide"}
SP500_Data <- read.csv(
  'SP5001913.csv')
```

   **Note:** For Original US CPI file see footnotes [^2]  

[^2]: ***US CPI file located here*** (https://www.kaggle.com/datasets/varpit94/us-inflation-data-updated-till-may-2021?select=US+CPI.csv)

   Load US CPI Dataset. 
   
  **Note:** *The document is be embedded for download. Insert your file path of where you saved the document* 
   
```{r warning = FALSE, message= FALSE, results = "hide"}
CPI_Data <- read.csv(
  'US CPI.csv')
```

   **Note:** For Original Fed Funds Rate data table see footnotes. [^3]  

[^3]: ***Fed Funds table is located here*** (https://www.thebalance.com/u-s-inflation-rate-history-by-year-and-forecast-3306093)

   Load US Fed Dataset.    
   
  **Note:** *The document is be embedded for download. Insert your file path of where you saved the document*
   
```{r warning = FALSE, message= FALSE, results = "hide"}
Fed_Data <- read.csv(
  'Inflation_Rate_Fed_Rate_1913_2017 - Sheet1.csv')
```

\newpage

&nbsp; 

## Reference Section:

1. Bond Yields and Interest Rates: 1900 to 2002. (2003). US CENSUS. Retrieved August 18, 2022, from 
 (https://www2.census.gov/library/publications/2004/compendia/statab/
 123ed/hist/hs-39.pdf)
The U.S. Census tracked The 3 Month Bond Yield from 1900 to 2002. The 3 Month Bond Yield is closely correlated with Federal Funds Rate. I used the 3 Month Bond Yield to fill in missing Federal Funds Rate data from 1900-1951.  

1. Amadeo, K. (2022, July 27). US Inflation Rate by Year: 1929–2023. The Balance. Retrieved August 18, 2022, from 
 (Https://www.thebalance.com/u-s-inflation-rate-history-by-year-and-forecast-3306093)
This project utilized The Balance published report "US Inflation Rate by Year From 1929 to 2023: How Bad Is Inflation? Past, Present, Future." BY KIMBERLY AMADEO, Updated July 27, 2022 REVIEWED BY ROBERT C. KELLY. 

1. Irizarry, R. A. (2022, July 7). Introduction to Data Science. HARVARD Data Science. Retrieved August 8, 2022, from 
 (Https://rafalab.github.io/dsbook/)
This project utilized "Introduction to Data Science Data Analysis and Prediction Algorithms with R" by our course instructor Rafael A. Irizarry published 2022-07-07  (Chapters 1 through 34).

1. Wheelock, D. C. (2021, September 13). Overview: The History of the Federal Reserve. Federal Reserve History. Retrieved August 8, 2022, from
 (https://www.federalreservehistory.org/essays/federal-reserve-history)
This project utilized the Overview: The History of the Federal Reserve. Published by  Federal Reserve Bank of St. Louis in 2021.

1. Julian  G.F. (2022, May 10). U.S Inflation - Analysis in R. Kaggle. Retrieved August 8, 2022, from
 (https://www.kaggle.com/code/fit4kz/u-s-inflation-analysis-in-r)
This project utilized the U.S Consumer Price Index (CPI) . This dataset provides average monthly data of CPI for all US cities.

1. Standard and Poor’s (S&P) 500 Index Data including Dividend, Earnings and P/E Ratio. (n.d.). DataHub. Retrieved August 8, 2022, from
(https://datahub.io/core/s-and-p-500)
The data provided is a version of the Economist Robert Shiller data. S&P 500 index data including level, dividend, earnings and P/E ratio on a monthly basis since 1870. 

1. Bloomberg. (2022, August 15). Inside the Founding of the Federal Reserve [Video]. YouTube.  (https://www.youtube.com/watch?v=0hzdglWpxVM&t=314s)
Author and journalist Roger Lowenstein describes the economic crises that led to the founding of the US Federal Reserve in 1913. 

1. U.S. Bureau of Labor Statistics. (2022). CPI Home : U.S. Bureau of Labor Statistics.  (https://www.bls.gov/cpi/)

1. Standard and Poor’s 500 (S&P 500) - Explained. (n.d.). The Business Professor, LLC. Retrieved August 22, 2022, from
 (https://thebusinessprofessor.com/en_US/investments-trading-financial-markets/standard-and-poors-500-sp-500-definition)

1. Introduction to ARIMA models. (2019). Duke.edu. (https://people.duke.edu/~rnau/411arim.htm)

1. Long, J. (2019, September 26). 14 Time Series Analysis | R Cookbook, 2nd Edition. Retrieved September 5, 2022, from (https://rc2e.com/timeseriesanalysis)

1. Srivastav, A. K. (2022, September 13). Pearson correlation coefficient. WallStreetMojo. Retrieved September 18, 2022, from https://www.wallstreetmojo.com/pearson-correlation-coefficient/

&nbsp;  

\newpage
## Overview:
&nbsp;  

##### Goal One: To examine the data to idenitfy any correlation using Pearson's Correlation Coefficient (r). 


##### Goal Two: Create a forecasting machine learning model using past data from 1929-2017 to predict inflation and the appropriate federal funds rate.

&nbsp;  

  Since 1929,  the U.S. has combated inflation.  An inflation rate of 2% is believed to be an excellent environment for businesses and consumers.  During deflation, corporations and local businesses lose pricing power.  Businesses have to shed employees, future investments, and goods to maintain a profit which causes an economic slowdown during deflationary periods.  During rising inflation above 2%, business profits rise temporally, but consumer pricing power is eroded over time, and it can lead to hyperinflation/economic crisis/economic slowdown.

   To prevent reoccurring economic collapses, deflation, galloping inflation and to fix the lack of synergy with the other 12 regional banks, The U.S. founded the Federal Reserve (the central bank) on December 23, 1913.  In this project, I will explore if correlations exist within the Monthly U.S. Consumer Price Index (CPI) average for all U.S. cities, Inflation Rate Year over Year (YoY), geopolitical events, economic events, GDP growth, Federal Funds Rate, and S&P 500 price annualized from 1929 to 2017.  I will also examine if one of the Federal Reserve most powerful tools, the Federal Funds Rate, is correlated with several factors listed above. I will create a forecasting algorithm using back dated information to predict inflation and appropriate federal fund rate to combat inflation. 

  To examine if the United States' geopolitical, domestic, and economic events are correlated with Inflation Rate YoY.  I will also examine how the Federal Reserve Fund Rate affects the following: Monthly U.S. Consumer Price Index (CPI) average for all U.S. cities, Inflation Rate YoY, Geopolitical events, Economic Events, GDP Growth, and S&P 500 annualized prices utilizing the Pearson's Correlation Coefficient (r).  I will also create a forecasting machine learning model using back dated information to predict inflation and appropriate federal funds rate

&nbsp;  

\newpage

## Data Wrangling: Clean! Clean! Clean!

##### Goal:  Clean the data.  Display the Federal Reserve Fund Rate, the Monthly U.S. Consumer Price Index (CPI) average for all U.S. cities, Inflation Year over Year (YoY), Geopolitical events, Economic Events, G.D.P. Growth, and S&P 500 price annualized from 1929-2017.
&nbsp;  

   The Standard & Poor's earliest origins can be linked to the stock market in 1923.  The Standard & Poor's index at the time contained 233 companies.  Today, it has 500 companies within its index.  It is widely tracked by economists, politicians, investors, and speculators.  It is often considered an early indicator of a possible economic expansion or slowdown. 

&nbsp; 

Review  S&P 500 Data
   
```{r warning = FALSE, message= FALSE, results = "hide"}
summary(SP500_Data)
head(SP500_Data, 20)
any(is.na(SP500_Data))
sum(is.na(SP500_Data))
```
&nbsp;  

   Removing all years and data before 1929 and after 2017
   
```{r warning = FALSE, message= FALSE, results = "hide"}
SP500_Data
New_SP500_Data <- SP500_Data[-c(1:192, 1261:1264),]
New_SP500_Data

SP_rows <-nrow(New_SP500_Data)
SP_rows
```
&nbsp;  
   
   Annualized the data with an Annual S&P Average Return
   
```{r warning = FALSE, message= FALSE, results = "hide"}
SP_Mon <- SP_rows/12
SP_Mon
Whole_SP_Mon<-SP_rows%/%12 
Whole_SP_Mon

series<-New_SP500_Data$SP500
mon = 12
new= NULL
for (i in 1: Whole_SP_Mon) {
  AnnualData<-series[((i-1)*mon+1):(i*mon)]
  AnnualAverage<-mean(AnnualData)
  new=rbind(new,AnnualAverage)
}
AverageSP500<-new
AverageSP500
```
&nbsp;  
  
   Convert to years and create a table
   
```{r warning = FALSE, message= FALSE, results = "hide"}
Calendar_Year_1<- rep(1928+1:length(AverageSP500))
Calendar_Year_1

Final_SP500 <- tibble(AverageSP500)
Final_SP500$new_col <- Calendar_Year_1
colnames(Final_SP500)<- c("Annual Closing Price", "Calendar_Year") 
```
&nbsp;  
   
   Double check the format and convert Annual Closing Price to dollars
   
```{r warning = FALSE, message= FALSE, results = "hide"}
head(Final_SP500)

New_AverageSP500 <- scales::dollar(Final_SP500$`Annual Closing Price`)

WithDollarSign_SP500 <- tibble(New_AverageSP500)
WithDollarSign_SP500$new_col <- Calendar_Year_1
colnames(WithDollarSign_SP500)<- c("Annual Closing Price", "Calendar_Year") 

wds <- head(WithDollarSign_SP500,10)
```
&nbsp;  
   
   Create a table to visualize the data
   
```{r warning = FALSE, message= FALSE, include=FALSE}
vizd <-wds %>%
  gt() %>%
  tab_header(
    title = md("**S&P 500 Annualized Closing Price**"),
    subtitle = md("HardvardX Capstone Project 2022")
  ) %>%
  cols_width(
    everything() ~ px(160)) %>%
  tab_source_note(
    source_note = md("Portions of this data is from the Reference Section.")
  ) %>%
  tab_footnote(
    footnote = md("S&P 500 Data is from 1929-2017")
  ) %>%
  opt_table_font(
    font = "Times New Roman",
    weight = 300) %>%
  cols_align(
    align = "center",
    columns = everything()
  ) %>% 
  tab_options(
    table.background.color = "cornsilk")
```
![](/Library/Frameworks/R.framework/Versions/4.2/images/vizd.png)
&nbsp;  

  Per the U.S. Bureau of Labor Statistics (“U.S. Bureau of Labor Statistics”, 2002), The Consumer Price Index (CPI)  is the most widely used measure of inflation and is an indicator of the effectiveness of government policy.  CPI is calculated by recording the group of goods, services, and housing that urban consumers purchase and the price  average change on a monthly basis.

   Load and clean CPI data 
   
```{r warning = FALSE, message= FALSE, results = "hide"}
summary(CPI_Data)
head(CPI_Data, 20)
any(is.na(CPI_Data))
sum(is.na(CPI_Data))
```
&nbsp;  
   
   Removing all years and data before 1929 and after 2017
   
```{r warning = FALSE, message= FALSE, results = "hide"}
CPI_Data
New_CPI_Data <- CPI_Data[-c(1:192, 1261:1303), ] 

CPI_rows <-nrow(New_CPI_Data)
CPI_rows
```
&nbsp;  
   
   Annualized the CPI data 
    
```{r warning = FALSE, message= FALSE, results = "hide"}
CPI_Mon <- CPI_rows/12
CPI_Mon
Whole_CPI_Mon<-CPI_rows%/%12 
Whole_CPI_Mon

series<-New_CPI_Data$CPI
mon = 12
new= NULL
for (i in 1: Whole_CPI_Mon) {
  AnnualCPIData<-series[((i-1)*mon+1):(i*mon)]
  AnnualCPIAverage<-mean(AnnualCPIData)
  new=rbind(new,AnnualCPIAverage)
}
AverageCPI<-new
AverageCPI
```
&nbsp;  
   
   Change it to percentage 
   
```{r warning = FALSE, message= FALSE, results = "hide"}
New_Avg_CPI <- scales::percent(AverageCPI/100)
New_Avg_CPI
```
&nbsp;  
   
   Make the years manually and create a table
   
```{r warning = FALSE, message= FALSE, results = "hide"}
CalendarYear<- rep(1928+1:length(New_Avg_CPI))
CalendarYear
```
```{r warning = FALSE, message= FALSE, results = "hide"}
Final_CPI <- tibble(New_Avg_CPI)
Final_CPI$new_col <- CalendarYear
colnames(Final_CPI)<- c("Annual_CPI_Average", "Calendar_Year") 
```
```{r warning = FALSE, message= FALSE, results = "hide"}
All_CPI <- tibble(Final_CPI)
acp <- head(All_CPI,10)
```
```{r warning = FALSE, message= FALSE, echo = FALSE}
at <- acp %>%
  gt() %>%
  tab_header(
    title = md("**Average U.S. CPI Accumulated Data Annualized**"),
    subtitle = md("HardvardX Capstone Project 2022")
  ) %>%
  cols_width(
    everything() ~ px(160)) %>%
  tab_source_note(
    source_note = md("Portions of this data is from the Reference Section")
  ) %>%
  tab_footnote(
    footnote = md("CPI Data is based on data from 1929-2017")
  ) %>%
  opt_table_font(
    font = "Times New Roman",
    weight = 300) %>%
  cols_align(
    align = "center",
    columns = everything()
  )%>% 
  tab_options(
    table.background.color = "oldlace")
```
![](/Library/Frameworks/R.framework/Versions/4.2/images/at.png)


&nbsp;  
  
  Since 1929, The United States has experienced different economic and geopolitical events.  The Federal Reserve monitors said events and create policies to accommodate the economy to prevent another Great Depression scenario.  Federal Reserve utilizes its "set of tools" to help promote a healthy business cycle based on their mandates.
    
  A Business Cycle is the beginning of an expansion(post-recession / post-economic slowdown) period and the beginning of a contraction period (recession/economic slowdown). 
    
  The Inflation Rate YoY is the rate of change of inflation yearly.  The Inflation rate YoY differs from CPI Annualized data.  CPI Annualized data shows how the value of products in 1929 appreciates every year until 2017 based on average inflation accumulated each year. For instance, a gallon of milk in Hawaii on the island of Oahu cost 26 cents in 1929 now a gallon of milk on the island of Oahu cost $5.50. Thats a whooping 2115% of accumulated inflation exceeding the 2017 percentage by 10x.  The Inflation Rate YoY shows the change in annual inflation in each specific year vice compounding year after year. The table below will show the changes for this metric. 
    
  GDP is the total of all goods produced and sold by a nation over a specific period.  This is an indicator of economic growth, stagnation, or slowing down. Let us take a look at U.S. Economic data, Geopolitical Events, and Federal Reserve Data. 
&nbsp;  

   Clean U.S. Economic and Event data 
   
```{r warning = FALSE, message= FALSE, results = "hide"}
summary(Fed_Data)
head(Fed_Data, 20)
any(is.na(Fed_Data))
sum(is.na(Fed_Data))
```
```{r warning = FALSE, message= FALSE, results = "hide"}
All_Fed <- tibble(Fed_Data)
colnames(All_Fed)<- c("Year", "Inflation Rate YoY", "Fed Funds Rate", 
                      "Business Cycle", "GDP Growth", 
                      "Events Affecting Inflation" )
afd<- head(All_Fed,10)
```
```{r warning = FALSE, message= FALSE, echo = FALSE}
td<- afd %>%
  gt() %>%
  tab_header(
    title = md("**U.S. Economic, Geopolitical Events and Federal Reserve Data**"),
    subtitle = md("HardvardX Capstone Project 2022")
  ) %>%
  cols_width(
    starts_with("Year") ~ px(60),
    everything() ~ px(130)) %>%
  cols_align(
    align = "center",
    columns = everything()
  ) %>%
  tab_source_note(
    source_note = md(" Portions of this data within this table is from Reference Section")
    ) %>%
  tab_footnote(
    footnote = md(" Federal Funds Rate is based on data from The 3 Month Bond Yield from 1929-1954")
  ) %>%
  opt_table_font(
    font = "Times New Roman",
    weight = 300) %>% 
  tab_options(
    table.background.color = "lightcyan")
```
![](/Library/Frameworks/R.framework/Versions/4.2/images/td.png)

&nbsp;  
   
Now that we have a better look at the data, it is hard to discern which economic event, geopolitical event or federal reserve action data correlates with one another. Let us visualize the data to see if we can find an inverse, positive, or no correlation. 
&nbsp;  

\newpage

##  Data Visualization: Plotting the Cleaned Data 

##### Goal:  Create visualizations with individual data and combined data. Observe any inverse, none, or positive correlations.
&nbsp;  

   Create a chart of CPI annualized data from 1929 to 2017
   
```{r warning = FALSE, message= FALSE, results = "hide"}
Final_CPI$Annual_CPI_Average = as.numeric(gsub("[\\%]", "",Final_CPI$Annual_CPI_Average))
Final_CPI
```
&nbsp;  
   
   Average Inflation
   
```{r warning = FALSE, message= FALSE}
Average_inflation <- mean(Final_CPI$Annual_CPI_Average)
Average_inflation
```
```{r warning = FALSE, message= FALSE, echo = FALSE}
ggplot(Final_CPI, aes(x = Annual_CPI_Average, y = Calendar_Year)) +
  geom_point(size = 0.5) +
  geom_vline(aes(xintercept = Average_inflation),
             color = "Blue", linetype="dashed", size = 0.5
  )+
  labs(
    title = "Average U.S. CPI Accumulated Data Annualized",
    subtitle = "HardvardX Capstone Project 2022",
    caption = "Blue Dotted Line is the Average CPI Annualized
    The Average is 87.71946. Portions of this data is from the Reference Section.",
    x = " Average U.S. CPI Accumulated Data Annualized (%)",
    y = "Year (1929 - 2017)",
  )+
  scale_x_continuous(breaks = c(0, 25, 50, 75, 100, 125, 150, 175, 200, 225, 250))+
  scale_y_continuous(breaks = c(1925, 1935, 1945, 1955, 1965, 1975, 1985, 1995, 2005, 2015, 2025))+
  theme_classic()+
  theme(
    plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
    plot.subtitle = element_text(hjust = 0.5),
    plot.caption = element_text(face = "italic", hjust = 0.5)) +
  coord_flip()+
  annotate("text", x = 19, y = 2010, label = "' --- Average CPI Annualized'",  size = 3, color = "blue")+
  annotate("text", x = 26.0, y = 2010, label = "LEGEND", size = 4, color = "grey")+
  annotate("text", x = 91 , y = 1945, label = " Average CPI Annualized ", size = 4, color = "blue")+
  annotate("text", x = 10, y = 2010, label = "' CPI '",  size = 3, color = "black")
```
&nbsp;  

   Create a chart of S&P 500 from 1929 to 2017 
   
```{r warning = FALSE, message= FALSE, include=FALSE}
Final_SP500$`Annual Closing Price` = as.numeric(gsub("[\\$, ]","", Final_SP500$`Annual Closing Price`))

Final_SP500

Average_SP500 <- mean(Final_SP500$`Annual Closing Price`)
Average_SP500
```
```{r warning = FALSE, message= FALSE, echo = FALSE}
ggplot(Final_SP500, aes(x = `Annual Closing Price`, y = Calendar_Year)) +
  geom_smooth(color = "green")+
  geom_point(aes(color = `Annual Closing Price`, 
                 size = .5),
             alpha = 0.5) +
  geom_vline(aes(xintercept = Average_SP500),
             color = "red", linetype="dashed", size = 0.5
  )+
  labs(
    title = " S&P 500 Average Closing Price Annualized",
    subtitle = "HardvardX Capstone Project 2022",
    caption = "Red Dotted Line is the Average S&P 500 Closing Price. 
    The Average is $412.97. Chart Scale is log10. Portions of this data is from the Reference Section.",
    x = " Average Price Annualized ($)",
    y = "Year (1929 - 2017)",
  )+
  scale_x_continuous(trans ="log10")+
  scale_y_continuous(trans = "log10")+
  theme_classic()+
  theme(
    plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
    plot.subtitle = element_text(hjust = 0.5),
    plot.caption = element_text(face = "italic", hjust = 0.5))+
  coord_flip() +
  annotate("text", x = 450, y = 1950, label = " Average S&P Closing Price ", size = 4, color = "red")
```
&nbsp;  
   
   Create a chart to compare average CPI annualized and S&P 500
   
```{r warning = FALSE, message= FALSE, echo = FALSE}
Comp_Inflation_SP500 <- ggplot() +
  geom_point(data = Final_SP500, aes(
  x = `Annual Closing Price`, y = Calendar_Year), color = "red"
  )+
  geom_point(data = Final_CPI, aes(
    x = Annual_CPI_Average, y = Calendar_Year), color = "blue")+
  labs(
    title = " S&P 500 Closing Price Annualized vs CPI Annualized",
    subtitle = "HardvardX Capstone Project 2022",
    caption = "Portions of this data is from the Reference Section. Chart scale is log10.",
    x = "S&P 500 Annualized ($) x CPI Annualized (%)",
    y = "Year (1929 - 2017)",
  )+
  scale_x_continuous(trans ="log10")+
  scale_y_continuous(trans = "log10")+
  theme_classic()+
  theme(
    plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
    plot.subtitle = element_text(hjust = 0.5),
    plot.caption = element_text(face = "italic", hjust = 0.5)) +
  annotate("text", x = 10, y = 2014, label = "S&P 500", color = "red", size = 2)+
  annotate("text", x = 12, y = 2014, label = "CPI", color = "blue", size = 2)+
  annotate("text", x = 15, y = 2014, label = "LEGEND", size = 4, color = "black")+
  annotate("text", x = 500, y = 1979, label = "81' Highest Fed Funds Rate to battle inflation", size = 2, color = "black")+
  annotate("text", x = 30, y = 1940, label = "29-33'Great Depresion & Deflation", size = 2, color = "black")+
  annotate("text", x = 2200, y = 2005, label = "07-09' The Great Recession ", size = 2, color = "black")+
  annotate("text", x = 150, y = 1967, label = "69-79' Lost Decade(Runaway Inflation)", size = 2, color = "black")+
  annotate("text", x = 70, y = 1949, label = "51' Federal Reserve Accord", size = 2, color = "black")+
  coord_flip()

Comp_Inflation_SP500
```
&nbsp;  

  The chart above shows how the Consumer Price Index has grown exponentially over time with the S&P 500.  The geopolitical and economic events reflect the S&P 500 negative/positive reactions in some cases and nil in others.  As CPI has grew gradually from the late 1970s, the S&P 500 has continued to grow faster in worth over time. 

 Federal Reserve's Fed Funds Rate is a tool utilized by the Federal Reserve to tackle inflation, economic slowdowns or promote growth in the economy. Chart of Federal Funds Rate from 1929 - 2017. 

```{r warning = FALSE, message= FALSE, results = "hide"}
All_Fed$`Fed Funds Rate` = as.numeric(gsub("[\\%, ]","", All_Fed$`Fed Funds Rate`))
All_Fed$`Inflation Rate YoY` = as.numeric(gsub("[\\%, ]","", All_Fed$`Inflation Rate YoY`))
All_Fed$`GDP Growth` = as.numeric(gsub("[\\%, ]","", All_Fed$`GDP Growth`))

All_Fed
```
```{r warning = FALSE, message= FALSE}
Average_Fed_Rate<- mean(All_Fed$`Fed Funds Rate`)
Average_Fed_Rate
```
```{r warning = FALSE, message= FALSE, echo = FALSE}
ggplot() +
  geom_point(data = All_Fed, aes(x = `Fed Funds Rate`,  y = Year), color = "red")+
  geom_vline(aes(xintercept = Average_Fed_Rate),
             color = "blue", linetype="dashed", size = 0.5
  )+
  labs(
    title = "Federal Funds Rate Annualized",
    subtitle = "HardvardX Capstone Project 2022",
    caption = "Blue Dotted Line is the Average Federal Funds Rate. 
    The Average is 3.673146. Chart scale log 10. 
    Portions of this data is from the Reference Section.",
    x = "Annual Average Federal Funds Rate(%)",
    y = "Year (1929-2017)",
  )+
  scale_x_continuous(breaks = c( -10, -5, 0, 5, 10, 15, 20))+
  scale_y_continuous(breaks = c(1925, 1935, 1945, 1955, 1965, 1975, 1985, 1995, 2005, 2015, 2025))+
  theme_classic()+
  theme(
    plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
    plot.subtitle = element_text(hjust = 0.5),
    plot.caption = element_text(face = "italic", hjust = 0.5))+
  annotate("text", x = 15, y = 2015, label = "'Fed Funds Rate'", size = 3, color = "red")+
  annotate("text", x = 14, y = 2015, label = "' --- Average Fed Funds Rate'",  size = 3, color = "blue")+
  annotate("text", x = 16, y = 2015, label = "LEGEND", size = 4, color = "black")+
  coord_flip()+
  annotate("text", x = 4 , y = 1944, label = " Average CPI Annualized ", size = 3, color = "blue")
```
&nbsp;  

Inflation at high levels is one of the most significant issues that can cause an economic slowdown. Chart of Federal Reserve's Fed Funds Rate and Inflation Rate YoY.

```{r warning = FALSE, message= FALSE, echo = FALSE}
ggplot(data = All_Fed, aes( x = `Year`))+
  geom_bar(aes(y = `Fed Funds Rate`), stat = "identity", position = "identity", alpha =.3, fill= 'lightblue', color= 'lightblue4', show.legend = T)+
  geom_bar(aes(y = `Inflation Rate YoY`), stat = "identity", position = "identity", alpha =.8, fill= 'pink', color= 'red', show.legend = T)+
  labs(
    title = " Federal Funds Rate and Inflation Rate YoY",
    subtitle = "HardvardX Capstone Project 2022",
    caption = "Federal Funds Rate (BLUE) and Inflation Rate YoY (RED). 
    Portions of this data is from the Reference Section.",
    x = "Year (1929 - 2017)",
    y = "Federal Funds Rate(%) x  Inflation Rate YoY(%)"
  )+
  scale_y_continuous(breaks = c( -10, -5, 0, 5, 10, 15, 20))+
  scale_x_continuous(breaks = c(1925, 1935, 1945, 1955, 1965, 1975, 1985, 1995, 2005, 2015, 2025))+
  theme_linedraw()+
  theme(
    plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
    plot.subtitle = element_text(hjust = 0.5),
    plot.caption = element_text(face = "italic", hjust = 0.5))+
  annotate("text", x = 2010, y = -10, label = "'Inflation Rate YoY'", size = 3, color = "red")+
  annotate("text", x = 2010, y = -11, label = "'Fed Funds Rate'",  size = 3, color = "lightblue4")+
  annotate("text", x = 2010, y = -7, label = "LEGEND", size = 4, color = "black")
```
&nbsp;  
   
   Looking at the chart above, we can assess that the Federal Funds Rate and Inflation Rate YoY tend to trend in the same direction annually (the data overlap).  We will dig deeper into the data later for confirmation.  

   Negative GDP signals economic slowdown, a neutral rate indicates economic stagnation, and a positive rising GDP rate signals economic expansion.  Let's take a look at GDP. Chart of GDP Growth with the Average GDP.

```{r warning = FALSE, message= FALSE}
Average_GDP_Rate<- mean(All_Fed$`GDP Growth`)
Average_GDP_Rate
```
```{r warning = FALSE, message= FALSE, echo = FALSE}
ggplot(data = All_Fed, aes( x = `Year`))+
  geom_bar(aes(y = `GDP Growth`), width = 1, stat = "identity", position = "identity", alpha = 1, fill= 'purple', color= 'black')+
  labs(
    title = " GDP Growth Annualized ",
    subtitle = "HardvardX Capstone Project 2022",
    caption = " Average GDP is 3.38%. Portions of this data is from the Reference Section.",
    x = "Year (1929 - 2017)",
    y = "GDP Growth (%)"
  )+
  scale_y_continuous(breaks = c(-20, -15, -10, -5, 0, 5, 10, 15, 20))+
  scale_x_continuous(breaks = c(1925, 1935, 1945, 1955, 1965, 1975, 1985, 1995, 2005, 2015, 2025))+
  theme_classic()+
  theme(
        plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        plot.caption = element_text(face = "italic", hjust = 0.5))+
  annotate("segment", x = 1928, xend = 2017, y = 3.38, yend = 3.38 , linetype =2, size = .8, color = "gold3")+
  annotate("text", x = 2010, y = -10, label = "' --- Average GDP Growth'",  size = 3, color = "gold4")+
  annotate("text", x = 2010, y = -9, label = "LEGEND", size = 4, color = "black")+
  annotate("text", x = 2011 , y = 4.9, label = " Average GDP Growth ", size = 3, color = "gold4")
```
&nbsp; 


   Create a chart of GDP Growth and Inflation Rate YoY
   
```{r warning = FALSE, message= FALSE, echo = FALSE}
ggplot(data = All_Fed, aes( x = `Year`))+
  geom_bar(aes(y = `GDP Growth`), stat = "identity", position = "identity", alpha =.8, fill= 'green', color= 'blue')+
  geom_bar(aes(y = `Inflation Rate YoY`), stat = "identity", position = "identity", alpha =.2, fill= 'red', color= 'black')+
  labs(
    title = " GDP Growth and Inflation Rate YoY (1929 - 2017)",
    subtitle = "HardvardX Capstone Project 2022",
    caption = "Dark Green color is from GDP Growth  and Inflation Rate YoY overlaping. Portions of this data is from the Reference Section.",
    x = "Year (1929 - 2017)",
      y = "GDP Growth (%) x Inflation Rate YoY(%)"
  )+
  scale_y_continuous(breaks = c( -10, -5, 0, 5, 10, 15, 20))+
  scale_x_continuous(breaks = c(1925, 1935, 1945, 1955, 1965, 1975, 1985, 1995, 2005, 2015, 2025))+
  theme_classic()+
  theme(
        plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        plot.caption = element_text(face = "italic", hjust = 0.5))+
  annotate("text", x = 2010, y = -10, label = "'Inflation Rate YoY'", size = 3.5, color = "red")+
  annotate("text", x = 2010, y = -12, label = "'GDP Growth'",  size = 3.5, color = "green")+
  annotate("text", x = 2010, y = -8, label = "LEGEND", size = 4, color = "black")+
  annotate("text", x = 2010, y = -14.2, label = "'Data Overlap'",  size = 3.5, color = "dark green")
```
&nbsp;  
    
  After looking at the visualizations, we noticed that some data might have a positive correlation while others have an inverse or no correlation.  

  I also noticed that U.S. CPI and S&P 500 annualized are more exponential growth over time than the other variables.  The Federal Reserve is not mandated to manage the S&P 500 and is banned from buying stocks per the Federal Reserve Act.  For this purpose, we will only examine Inflation YoY, GDP Growth, and CPI Average Annualized versus the Federal Reserve's Fed Funds Rate.  We will use Pearson's Correlation Coefficient in our Data Analysis - Correlation Section to accurately compute the correlations.
&nbsp;  

\newpage

## Data Analysis: Discovering Correlations   

##### Goal:  To observe if the Fed Funds Rate has a positive, negative or no correlation with Inflation YoY, GDP Growth and CPI Average Annualized from 1929 - 2017. 
&nbsp;  

  I will use Pearson's Correlation Coefficient.  Pearson's Correlation Coefficient measures the linear correlation between two variables.  For the Pearson's Correlation Coefficient, the value "r" represents the correlation.  

  If r = 0:1, this means an absolute correlation (the variables move in the same direction).  If r = 0, this means no correlation between the two variables, and the value r = 0:-1 means a negative correlation (the variables move in the inverse direction).  For more information on Pearson's Correlation or any correlation formula, please refer to the Reference Section.
  
Pearson Correlation Coefficient Formula (Srivastav, 2022): 
r = 

$${n}(\sum xy)- (\sum x) (\sum y)\\\sqrt{[n\sum x^2 - (\sum x)^2] [n\sum y^2 - (\sum y)^2]}$$

r	=	correlation coefficient.   n = number of pairs of scores.
$x$	=	values of the x-variable in a sample.  
$y$	=	values of the y-variable in a sample.  
$\sum$	=	sum of. 
&nbsp;  

   Create a table with all the variables needed.
   
```{r warning = FALSE, message= FALSE, results = "hide"}
All_CorrData <- tibble(All_Fed$Year,
                       All_Fed$`Inflation Rate YoY`,
                       All_Fed$`Fed Funds Rate`,
                       All_Fed$`GDP Growth`,
                       Final_CPI$Annual_CPI_Average
)

colnames(All_CorrData)<- c("Year", "Inflation Rate YoY", 
                           "Fed Funds Rate", "GDP Growth", "Annual CPI Average")
any(is.na(All_CorrData))
sum(is.na(All_CorrData))
head(All_CorrData, 20)
All_CorrData
acd<-head(All_CorrData,10)
```

```{r warning = FALSE, message= FALSE, echo = FALSE}
avn<- acd %>%
  gt() %>%
  tab_header(
    title = md("**Variables for Pearson's (r) Data Examination**"),
    subtitle = md("HardvardX Capstone Project 2022")
  ) %>%
  cols_width(
    everything() ~ px(160)) %>%
  tab_source_note(
    source_note = md("Portions of this data is from the Reference Section.")
  ) %>%
  tab_footnote(
    footnote = md("All Data is from 1929-2017")
  ) %>%
  opt_table_font(
    font = "Times New Roman",
    weight = 300) %>%
  cols_align(
    align = "center",
    columns = everything()
  ) %>% 
  tab_options(
    table.background.color = "gray92")
```
![](/Library/Frameworks/R.framework/Versions/4.2/images/avn.png)

&nbsp;  

Testing the Pearson's Correlation Coefficient (r) Formula for Federal Funds Rate vs U.S. Inflation Rate YoY
   
```{r warning = FALSE, message= FALSE}

cor.test(All_CorrData$'Fed Funds Rate', All_CorrData$'Inflation Rate YoY')
```
&nbsp;  

Since the correlation is .4650834, we can see we have a positive but moderate correlation with Federal Funds Rate and Inflation Rate YoY

To compute the amount of variation between each variable we will utilize R^2^ and convert it to a percentage

```{r warning = FALSE, message= FALSE}
r2FI<- percent(sqrt(.4650834))
r2FI
```
&nbsp;  

With a R^2^ of 68% this means that 32% of variance is explained by unknown factors. 

Testing the Pearson Correlation Coefficient (r) Formula for Federal Funds Rate vs GDP Growth

```{r warning = FALSE, message= FALSE}
cor.test(All_CorrData$'Fed Funds Rate', All_CorrData$'GDP Growth')
```
&nbsp;  
    
  Since the correlation is -0.0311815, we can see we have a negative to no correlation with Federal Funds Rate and GDP Growth

   To compute the amount of variation between each variable we will utilize R^2^ and convert it to a percentage (remove the negative number for r will not compute)
   
```{r warning = FALSE, message= FALSE}
r2FG<- percent(sqrt(0.0311815))
r2FG
```
&nbsp;  
    
  With a R^2^ of 18% this means that 82% of variance is explained by unknown factors. 

   Testing the Pearson Correlation Coefficient (r) Formula for Federal Funds Rate vs Annual CPI Average.
   
```{r warning = FALSE, message= FALSE}
cor.test(All_CorrData$'Fed Funds Rate', All_CorrData$'Annual CPI Average')
```
&nbsp;  
    
  Since the correlation is 0.02542312, we can see we have a positive but little correlation with Federal Funds Rate and Annual CPI Average

   To compute the amount of variation between each variable we will utilize R^2^ and convert it to a percentage
   
```{r warning = FALSE, message= FALSE}
r2FC<- percent(sqrt(0.02542312))
r2FC
```
&nbsp;  
   
  With a R^2^ of 16% this means that 84% of variance is explained by unknown factors. 

   Summary Table of the Pearson's Correlation 1929-2017 results 
   
```{r warning = FALSE, message= FALSE, include= FALSE}
Initial_Pearson_Results <- tibble(r2FI,
                       r2FG,
                       r2FC
)
colnames(Initial_Pearson_Results)<- c("Fed Funds Rate vs Inflation YoY", 
                                      "Fed Funds Rate vs GDP Growth",
                                      "Fed Funds Rate vs Annual CPI Average")
Initial_Pearson_Results 

Initial_Pearson_Results$"Fed Funds Rate vs Inflation YoY" = as.numeric(gsub("[\\%]", "",Initial_Pearson_Results$"Fed Funds Rate vs Inflation YoY"))

Initial_Pearson_Results$"Fed Funds Rate vs GDP Growth" = as.numeric(gsub("[\\%]", "",Initial_Pearson_Results$"Fed Funds Rate vs GDP Growth"))

Initial_Pearson_Results$"Fed Funds Rate vs Annual CPI Average" = as.numeric(gsub("[\\%]", "",Initial_Pearson_Results$"Fed Funds Rate vs Annual CPI Average"))


Initial_Pearson_Results 
```
```{r warning = FALSE, message= FALSE, echo = FALSE}
ipr <- Initial_Pearson_Results %>%
  gt() %>%
  tab_header(
    title = md("**Pearson's (r) Data Variable Variation (%)**"),
    subtitle = md("HardvardX Capstone Project 2022")
  ) %>%
  cols_width(
    everything() ~ px(160)) %>%
  tab_source_note(
    source_note = md("Portions of this data is from the Reference Section.")
  ) %>%
  tab_footnote(
    footnote = md("The data is from 1929-2017")
  ) %>%
  opt_table_font(
    font = "Times New Roman",
    weight = 300) %>%
  cols_align(
    align = "center",
    columns = everything()
  ) %>%
  data_color(
    columns = c("Fed Funds Rate vs Inflation YoY", 
                "Fed Funds Rate vs GDP Growth",
                "Fed Funds Rate vs Annual CPI Average"),
    colors = scales::col_numeric(
      palette = c(
        "white", "brown", "green"),
      domain = c(68, 18, 16)))
```
![](/Library/Frameworks/R.framework/Versions/4.2/images/ipr.png)

&nbsp;  
   
  As we can see, our best correlation with the Fed Funds Rate is Inflation Rate YoY.  An R^2^ of 68% means that unknown factors explain 32% of the variance.  The unknown factors could be outliers.  Outliers affect the accuracy of a Pearson's Correlation formula.  Let's create Linear Regression charts to view the correlations and see if we have any outliers. 
&nbsp;  

\newpage

## Data Analysis: Correlation Visualization

##### Goal:  To visualize the data. Observe what factor(s) are causing the major divergences in correlation. 
&nbsp;  

  Scatterplot Pearson's Correlation Coefficient (r) Formula for Federal Funds Rate vs U.S. Inflation Rate YoY
  
```{r warning = FALSE, message= FALSE, results = "hide"}
data <- data.frame(x= All_CorrData$'Fed Funds Rate',
                   y= All_CorrData$'Inflation Rate YoY')
```
```{r warning = FALSE, message= FALSE, echo = FALSE}
ggplot(data,aes(x, y)) +
  geom_point(shape = 21,
             color = "black",
             fill = "purple",
             size = 4) +
  geom_smooth(method='lm', se=FALSE, color='red')+
  theme_classic() +
  labs(
    title = " Linear Regression: Fed Funds Rate vs U.S. Inflation Rate YoY",
    subtitle = "HardvardX Capstone Project 2022",
    caption = "Portions of this data is from 1929-2017 and Reference Section.
    t = 4.9002, df = 87, p-value = 4.392e-06 alternative hypothesis: true correlation
    is not equal to 0. 95 percent confidence interval: 0.2843698 0.6138815 sample estimates: 
    cor 0.4650834.",
    x = "Fed Funds Rate (%)",
    y = "Inflation Rate YoY Correlation (%)",
  ) +
  theme_bw()+
  theme(
        plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        plot.caption = element_text(face = "italic", hjust = 0.5))+
  scale_x_continuous(breaks = c(-20, -15, -10, -5, 0, 5, 10, 15, 20))+
  scale_y_continuous(breaks = c(-20, -15, -10, -5, 0, 5, 10, 15, 20))
```
&nbsp;  
    
  Linear Regression Chart of the Pearson's Correlation Coefficient (r) for Fed Funds Rate and Inflation Rate YoY from 1929-2017
    
```{r warning = FALSE, message= FALSE, echo = FALSE}
ggplot(All_CorrData, aes(x = Year, y = value, color = "red" ))+
  geom_point(aes(y = `Fed Funds Rate`, col = 'Fed Funds Rate'))+
  geom_point(aes(y = `Inflation Rate YoY`, col = 'Inflation Rate YoY'))+
  geom_smooth(aes(y = `Fed Funds Rate`, color = 'Fed Funds Rate' ), se = FALSE)+
  geom_smooth(aes(y = `Inflation Rate YoY`, color = 'Inflation Rate YoY' ), se = FALSE) +
  labs(
    title = " Pearson's (r) for Fed Funds Rate vs U.S. Inflation Rate YoY",
    subtitle = "HardvardX Capstone Project 2022",
    caption = "Portions of this data is from 1929-2017 and Reference Section.
    t = 4.9002, df = 87, p-value = 4.392e-06 alternative hypothesis: true correlation
    is not equal to 0. 95 percent confidence interval: 0.2843698 0.6138815 sample estimates: 
    cor 0.4650834.",
    x = "Year (1929-2017)",
    y = "Fed Funds Rate (%) x Inflation Rate YoY (%)",
  )+
  theme_classic()+
  theme(legend.title=element_blank(),
        legend.position = 'bottom',
        legend.text = element_text(size = 14),
        plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        plot.caption = element_text(face = "italic", hjust = 0.5))+
  scale_y_continuous(breaks = c(-20, -15, -10, -5, 0, 5, 10, 15, 20))+
  scale_x_continuous(breaks = c(1925, 1935, 1945, 1955, 1965, 1975, 1985, 1995, 2005, 2015, 2025))
```
&nbsp;  
  
  Scatterplot Pearson's Correlation Coefficient (r) Formula for Federal Funds Rate vs U.S. GDP Growth
   
```{r warning = FALSE, message= FALSE, results = "hide"}
FvGDPdata <- data.frame(x= All_CorrData$'Fed Funds Rate',
                   y= All_CorrData$'GDP Growth')
```
```{r warning = FALSE, message= FALSE, echo = FALSE}
ggplot(FvGDPdata,aes(x, y)) +
  geom_point(shape = 21,
             color = "black",
             fill = "orange",
             size = 4) +
  geom_smooth(method='lm', se=FALSE, color='red')+
  theme_classic() +
  labs(
    title = " Linear Regression: Fed Funds Rate vs U.S. GDP Growth",
    subtitle = "HardvardX Capstone Project 2022",
    caption = "Portions of this data is from 1929-2017 and Reference Section.
    t = -0.29098, df = 87, p-value = 0.7718 
    alternative hypothesis: true correlation is not equal to 0. 95 percent 
    confidence interval: -0.2378934  0.1782326. 
    sample estimates: cor  -0.0311815",
    x = "Fed Funds Rate (%)",
    y = "GDP Growth (%)",
  ) +
  theme_classic()+
  theme(
        plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        plot.caption = element_text(face = "italic", hjust = 0.5))+
  scale_x_continuous(breaks = c(-20, -15, -10, -5, 0, 5, 10, 15, 20))+
  scale_y_continuous(breaks = c(-20, -15, -10, -5, 0, 5, 10, 15, 20))
```
&nbsp;  
    
    Linear Regression Chart of the Pearson's Correlation Coefficient (r) for Fed Funds Rate and GDP Growth from 1929-2017
   
```{r warning = FALSE, message= FALSE, echo = FALSE}
ggplot(All_CorrData, aes(x = Year, y = value, color = "red" ))+
  geom_point(aes(y = `Fed Funds Rate`, col = 'Fed Funds Rate'))+
  geom_point(aes(y = `GDP Growth`, col = 'GDP Growth'))+
  geom_smooth(aes(y = `Fed Funds Rate`, color = 'Fed Funds Rate' ), se = FALSE)+
  geom_smooth(aes(y = `GDP Growth`, color = 'GDP Growth' ), se = FALSE) +
  labs(
    title = " Pearson's (r) for Federal Funds Rate vs U.S. GDP Growth",
    subtitle = "HardvardX Capstone Project 2022",
    caption = "Portions of this data is from 1929-2017 and Reference Section. 
    t = -0.29098, df = 87, p-value = 0.7718 alternative hypothesis: true correlation is not equal to 0. 95 percent confidence interval: -0.2378934  0.1782326. 
    sample estimates: cor  -0.0311815",
    x = "Year (1929-2017)",
    y = "Fed Funds Rate (%) x GDP Growth (%)",
  )+
  theme_classic()+
  theme(legend.title=element_blank(),
        legend.position = 'bottom',
        legend.text = element_text(size = 14),
        plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        plot.caption = element_text(face = "italic", hjust = 0.5))+
  scale_y_continuous(breaks = c(-20, -15, -10, -5, 0, 5, 10, 15, 20))+
  scale_x_continuous(breaks = c(1925, 1935, 1945, 1955, 1965, 1975, 1985, 1995, 2005, 2015, 2025))
```
&nbsp;  
   
  Scatterplot Pearson's Correlation Coefficient (r) Formula for Federal Funds Rate vs CPI Accumulated Average Annualized
   
```{r warning = FALSE, message= FALSE, results = "hide"}
FvCPIdata <- data.frame(x= All_CorrData$'Fed Funds Rate', 
                        y= All_CorrData$"Annual CPI Average")
```
```{r warning = FALSE, message= FALSE, echo = FALSE}
ggplot(FvCPIdata,aes(x, y)) +
  geom_point(shape = 21,
             color = "turquoise",
             fill = "dark green",
             size = 2) +
  geom_smooth(method='lm', se=FALSE, color='red')+
  theme_classic() +
  labs(
    title = " Linear Regression: Fed Funds Rate vs U.S. CPI  Annualized",
    subtitle = "HardvardX Capstone Project 2022",
    caption = "Portions of this data is from 1929-2017 and Reference Section.
    t = 0.23721, df = 87, p-value = 0.8131 
    alternative hypothesis: true correlation is not equal to 0. 95 percent 
    confidence interval: -0.1838068  0.2324491 sample estimates: cor 0.02542312",
    x = "Fed Funds Rate (%)",
    y = "Annual CPI Average (%)",
  ) +
  theme_classic()+
  theme(
        plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        plot.caption = element_text(face = "italic", hjust = 0.5))+
  scale_x_continuous(breaks = c(0, 25, 50 ,75, 100, 125, 150, 175, 200, 225, 250 ))+
  scale_y_continuous(breaks = c(0, 25, 50 ,75, 100, 125, 150, 175, 200, 225, 250 ))
```
&nbsp;  
    
    Linear Regression Chart of the Pearson's Correlation Coefficient (r) for Fed Funds Rate and Annual CPI Average from 1929-2017
   
```{r warning = FALSE, message= FALSE, echo = FALSE}
ggplot(All_CorrData, aes(x = Year, y = value))+
  geom_point(aes(y = `Fed Funds Rate`, col = 'Fed Funds Rate'))+
  geom_point(aes(y = `Annual CPI Average`, col = "Annual CPI Average"))+
  labs(
    title = " Pearson's (r) for Fed Funds Rate vs Average U.S. CPI Annualized ",
    subtitle = "HardvardX Capstone Project 2022",
    caption = "t = 0.23721, df = 87, p-value = 0.8131 alternative hypothesis: true correlation
    is not equal to 0. 95 percent confidence interval: -0.1838068  0.2324491 sample estimates: 
    cor 0.02542312  Portions of this data is from the Reference Section.",
    x = "Year (1929-2017)",
    y = "Fed Funds Rate (%) x Average CPI Annualized (%)",
  )+
  theme_classic()+
  theme(legend.title=element_blank(),
        legend.position = 'bottom',
        legend.text = element_text(size = 14),
        plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        plot.caption = element_text(face = "italic", hjust = 0.5))
```
&nbsp;  
    
  As depicted in each chart, outliers can affect Pearson's correlation accuracy, but we also can see that all other data displayed in each chart had a distinct or indistinct correlation. 

  On a good note, we did have a positive but moderate correlation with Federal Funds Rate and Inflation Rate YoY.  An R^2^ of 68% means that unknown factors explain 32% of the variance.  

   Let us chart the economic and geopolitical events with Federal Funds Rate and Inflation Rate YoY to see if the "outliers" were economic/geopolitical driven.
   
```{r warning = FALSE, message= FALSE, results = "hide"}
Conclusion_All_Fed <- tibble(All_Fed)
Conclusion_All_Fed$new_col <- WithDollarSign_SP500$`Annual Closing Price`
colnames(Conclusion_All_Fed)<- c("The_Year", "Inflation Rate YoY", "Fed Funds Rate", "Business Cycle", "GDP Growth", "Events Affecting Inflation", "SP500 Annual Closing Price")

print(select_if(Conclusion_All_Fed, is.numeric))
```

&nbsp;  
   
   In addition let us plot all GDP data points that are greater than  or equal to the GDP annualized average of 3.38. 
   
```{r warning = FALSE, message= FALSE, results= "hide"}
GREATER_THAN_Avg_GDP <- subset(Conclusion_All_Fed, `GDP Growth` >= 3.38)
GREATER_THAN_Avg_GDP
```
```{r warning = FALSE, message= FALSE, echo = FALSE}
ggplot(data = Conclusion_All_Fed, aes(x = The_Year))+
  geom_bar(aes(y = `Fed Funds Rate`), stat = "identity", position = "identity", alpha =.3, fill= 'lightblue', color= 'lightblue4')+
  geom_bar(aes(y = `Inflation Rate YoY`), stat = "identity", position = "identity", alpha =.8, fill= 'pink', color= 'red')+
  geom_point(data = GREATER_THAN_Avg_GDP, aes(
    y = `GDP Growth`), shape = 23, size = 2, color = "black", fill= "dark green")+
  labs(
    title = " Federal Funds Rate x Inflation Rate YoY x GDP ",
    subtitle = "HardvardX Capstone Project 2022",
    caption = "*Only plotted GDP greater than annualized average of 3.38%. Portions of this data is from the Reference Section.",
    x = "Year (1929 - 2017)",
    y = "Fed Funds Rate(%) x Avg. GDP(%) x Inflation Rate YoY(%)"
  )+
  scale_y_continuous(breaks = c( -30, -25, -20, -15, -10 -5, 0, 5, 10, 15, 20, 25, 30 ))+
  scale_x_continuous(breaks = c(1925, 1935, 1945, 1955, 1965, 1975, 1985, 1995, 2005, 2015, 2025))+
  theme_linedraw()+
  theme(
    plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
    plot.subtitle = element_text(hjust = 0.5),
    plot.caption = element_text(face = "italic", hjust = 0.5))+
  annotate("text", x = 1975, y = -8, label = "'Inflation Rate YoY'", size = 3, color = "red")+
  annotate("text", x = 1975, y = -9.5, label = "'Fed Funds Rate'",  size = 3, color = "lightblue4")+
  annotate("text", x = 1975, y = -6, label = "LEGEND", size = 4, color = "black")+
  annotate("text", x = 1980, y = 18.5, label = "81' Highest Fed Funds Rate", size = 2, color = "black")+
  annotate("text", x = 1953, y = 18.5, label = "46' Budget cuts post WWII", size = 2, color = "black")+
  annotate("text", x = 1934, y = 18.9, label = "39-45' WWII highest GDP", size = 2, color = "black")+
  annotate("text", x = 1938, y = -11.5, label = "29-33'Great Depresion & Deflation", size = 2.5, color = "black")+
  annotate("text", x = 2008, y = 6, label = "07-09' Great Recession ", size = 2, color = "black")+
  annotate("text", x = 1970, y = 13.5, label = "69-79' Runaway Inflation", size = 2, color = "black")+
  annotate("text", x = 1975, y = -10.9, label = "'GDP >=3.38'",  size = 3, color = "dark green")+
  annotate("text", x = 1950, y = -2.9, label = "51' Federal Reserve Accord", size = 3, color = "black")
```
&nbsp;  
   
   As we can see, outliers are caused by economic and geopolitical factors. These factors can affect inflation and the Federal Reserve's Fund Rate. 

  Additionally, the majority of the outliers happened prior to 1951. Let us look at a chart highlighting outliers and correlated data for the Federal Funds Rate vs Inflation Rate YoY from 1929-2017. 
  
```{r warning = FALSE, message= FALSE, echo = FALSE}
ggplot() +
  geom_point(data = All_Fed, aes(
    x = `Fed Funds Rate`, y = Year), color = "red"
  )+
  geom_point(data = All_Fed, aes(
    x = `Inflation Rate YoY`, y = Year), color = "blue")+
  labs(
    title = " Federal Funds Rate & Inflation Rate YoY",
    subtitle = "HardvardX Capstone Project 2022",
    caption = "Portions of this data is from the Reference Section.",
    x = "Federal Funds Rate (%) x Inflation Rate YoY(%)",
    y = "Year (1929 - 2017)",
  )+
  scale_x_continuous(breaks = c( -10, -5, 0, 5, 10, 15, 20))+
  scale_y_continuous(breaks = c(1925, 1935, 1945, 1955, 1965, 1975, 1985, 1995, 2005, 2015, 2025))+
  theme_bw()+
  theme(
    plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
    plot.subtitle = element_text(hjust = 0.5),
    plot.caption = element_text(face = "italic", hjust = 0.5)) +
  coord_flip()+
  annotate("text", x = -12, y = 1975, label = "Fed Funds Rate", color = "red")+
  annotate("text", x = -10.5, y = 1975, label = "Inflation Rate YoY", color = "blue")+
  annotate("text", x = -9, y = 1975, label = "LEGEND", size = 4, color = "black")+
  annotate("rect", xmin = -0.9, xmax = 10.2, ymin= 1951, ymax = 2020, alpha = .2, color = "yellow")+
  annotate("rect", xmin = -0.9, xmax = 4, ymin= 1928, ymax = 1950.8, alpha = .2, color = "green")+
  annotate("text", x = -1.5, y = 1940, label = "Before 1951", color = "dark green", size = 5)+
  annotate("text", x = -1.5, y = 1985, label = "After 1951", color = "tan4", size = 5)
```
&nbsp;  

   As you can see, before 1951, there were 11 outliers and only six after 1951. This may be attributed to the Federal Reserve and U.S. Treasury signing the Accord in 1951. This Accord allowed the Federal Reserve to act independently, utilize its economic tools to fight inflation, and implement monetary policy.   

   Lets see if the correlation changes if I remove 1929-1950 data. Test the Pearson's Correlation Coefficient (r) Formula for Federal Funds Rate vs U.S. Inflation Rate YoY
   
```{r warning = FALSE, message= FALSE}
a1951_Fed <- All_Fed[-c(1:22), ]

cor.test(a1951_Fed$'Fed Funds Rate', a1951_Fed$'Inflation Rate YoY')
```
&nbsp;  
   
  Since the correlation is 0.7710506, we can see we have a positive but moderate correlation with Federal Funds Rate and Inflation Rate YoY

   To compute the amount of variation between each variable we will utilize R^2^ and convert it to a percentage
   
```{r warning = FALSE, message= FALSE}
New_r2FI<- percent(sqrt(0.7710506))
New_r2FI
```
&nbsp;  
    
  With a R^2^ of 88% this means that 12% of variance is explained by unknown factors. 

  Scatterplot Pearson's Correlation Coefficient (r) Formula for Federal Funds Rate vs U.S. Inflation Rate YoY
  
```{r warning = FALSE, message= FALSE}
NEW_1951_data <- data.frame(x= a1951_Fed$'Fed Funds Rate',
                   y= a1951_Fed$'Inflation Rate YoY')
```
```{r warning = FALSE, message= FALSE, echo = FALSE}
ggplot(NEW_1951_data,aes(x, y)) +
  geom_point(shape = 21,
             color = "black",
             fill = "lawngreen",
             size = 4) +
  geom_smooth(method='lm', se=FALSE, color='red')+
  theme_classic() +
  labs(
    title = " Linear Regression: Fed Funds Rate vs Inflation Rate YoY (1951-2017)",
    subtitle = "HardvardX Capstone Project 2022",
    caption = "Portions of this data is from 1951-2017 and the Reference Section. 
    t = 9.7623, df = 65, p-value = 2.299e-14 alternative hypothesis: true correlation
    is not equal to 0. 95 percent confidence interval: 0.6515102 0.8532300 sample estimates: 
    cor 0.7710506",
    x = "Fed Funds Rate (%)",
    y = "Inflation Rate YoY (%)",
  ) +
  theme_bw()+
  theme(
        plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        plot.caption = element_text(face = "italic", hjust = 0.5))+
  scale_x_continuous(breaks = c(-20, -15, -10, -5, 0, 5, 10, 15, 20))+
  scale_y_continuous(breaks = c(-20, -15, -10, -5, 0, 5, 10, 15, 20))
```
&nbsp;  
   
  Linear Regression Chart of the Pearson's (r) for Fed Funds Rate and Inflation Rate YoY from 1951-2017
  
```{r warning = FALSE, message= FALSE, results= "hide"}
NEW_1951_data
colnames(Final_CPI)<- c("Annual_CPI_Average", "Calendar_Year")
```
```{r warning = FALSE, message= FALSE, echo = FALSE}
ggplot(a1951_Fed, aes(x = Year, y = value, color = "red" ))+
  geom_point(aes(y = `Fed Funds Rate`, col = 'Fed Funds Rate'))+
  geom_point(aes(y = `Inflation Rate YoY`, col = 'Inflation Rate YoY'))+
  geom_smooth(aes(y = `Fed Funds Rate`, color = 'Fed Funds Rate' ), se = FALSE)+
  geom_smooth(aes(y = `Inflation Rate YoY`, color = 'Inflation Rate YoY' ), se = FALSE) +
  labs(
    title = " Pearson's (r) for Fed Funds Rate vs U.S. Inflation Rate YoY (1951-2017)",
    subtitle = "HardvardX Capstone Project 2022",
    caption = "Portions of this data is from 1951-2017 and the Reference Section. 
    t = 9.7623, df = 65, p-value = 2.299e-14 alternative hypothesis: true correlation
    is not equal to 0. 95 percent confidence interval: 0.6515102 0.8532300 sample estimates: 
    cor 0.7710506.",
    y = "Fed Funds Rate (%) x Inflation Rate YoY Correlation (%)",
  )+
  theme_classic()+
  theme(legend.title=element_blank(),
        legend.position = 'bottom',
        legend.text = element_text(size = 14),
        plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        plot.caption = element_text(face = "italic", hjust = 0.5))+
  scale_y_continuous(breaks = c(-20, -15, -10, -5, 0, 5, 10, 15, 20))+
  scale_x_continuous(breaks = c(1925, 1935, 1945, 1955, 1965, 1975, 1985, 1995, 2005, 2015, 2025))
```
&nbsp;  
   
  Pearson's Correlation Results:
    
```{r warning = FALSE, message= FALSE, include= FALSE}
Final_Pearson_Results <- tibble(New_r2FI,
                                r2FI,
                                r2FG,
                                r2FC
)
colnames(Final_Pearson_Results)<- c("Fed Funds Rate vs Inflation YoY after 1951", 
                                    "Fed Funds Rate vs Inflation YoY before 1950", 
                                    "Fed Funds Rate vs GDP Growth",
                                    "Fed Funds Rate vs Annual CPI Average"
)

Final_Pearson_Results 

Final_Pearson_Results$"Fed Funds Rate vs Inflation YoY before 1950" = as.numeric(gsub("[\\%]", "",Final_Pearson_Results$"Fed Funds Rate vs Inflation YoY before 1950"))

Final_Pearson_Results$"Fed Funds Rate vs GDP Growth" = as.numeric(gsub("[\\%]", "",Final_Pearson_Results$"Fed Funds Rate vs GDP Growth"))

Final_Pearson_Results$"Fed Funds Rate vs Inflation YoY after 1951" = as.numeric(gsub("[\\%]", "",Final_Pearson_Results$"Fed Funds Rate vs Inflation YoY after 1951"))

Final_Pearson_Results$"Fed Funds Rate vs Annual CPI Average" = as.numeric(gsub("[\\%]", "",Final_Pearson_Results$"Fed Funds Rate vs Annual CPI Average"))
```
```{r warning = FALSE, message= FALSE, echo = FALSE}
fpr<- Final_Pearson_Results %>%
  gt() %>%
  tab_header(
    title = md("Final Pearson's (r) Variable Variation Data (%)"),
    subtitle = md("HardvardX Capstone Project 2022")
  ) %>%
  cols_width(
    everything() ~ px(160)) %>%
  tab_source_note(
    source_note = md("Portions of this data is from the Reference Section.")
  ) %>%
  opt_table_font(
    font = "Times New Roman",
    weight = 300) %>%
  cols_align(
    align = "center",
    columns = everything()
  ) %>%
  data_color(
    columns = c("Fed Funds Rate vs Inflation YoY before 1950", 
                "Fed Funds Rate vs GDP Growth",
                "Fed Funds Rate vs Annual CPI Average",
                "Fed Funds Rate vs Inflation YoY after 1951"),
    colors = scales::col_numeric(
      palette = c(
        "white", "brown", "green"),
      domain = c(88, 68, 18, 16)))
```
![](/Library/Frameworks/R.framework/Versions/4.2/images/fpr.png)

&nbsp;  

    After focusing on when the Federal Reserve could use the full range of its tools to combat Inflation Rate YoY and removing the outliers from 1929-1950, we achieved a Pearson's (r) of 0.7710506 and an R^2^ of 88%.  This means that unknown factors explain 12% of the variance.  We identified the unknown factors in our visualizations.  We know with high confidence that the Federal Fund Rate positively correlates with the Inflation Rate YoY.
    
Ratio Federal Funds Rate vs Inflation Rate YoY to determine Forecasting Model Tolerance. 

```{r warning = FALSE, message= FALSE}
Model_Tolerance <- mean(All_Fed$`Inflation Rate YoY`)/mean(All_Fed$`Fed Funds Rate`)

Model_Tolerance
```
&nbsp;  

Lets round the tolerance to the nearest whole number for simplicity. We will use this in our forecasting model. 

```{r warning = FALSE, message= FALSE}
round(Model_Tolerance)
```
&nbsp;  

\newpage

## Data Analysis: Machine Learning Forecasting and Backtesting Model

##### Goal:  Create a Machine Learning Inflation and Federal Reserve Fund Rate Forecasting and Backtest Model.
&nbsp;  

  Using Pearson's Correlation, we concluded that the Inflation Rate YoY has a strong positive correlation with Federal Reserve's Federal Funds Rate.  Let us create a machine learning forecasting model to predict future Inflation Rate YoY and Federal Funds Rate.  To make this model sustainable, we will have to backtest with primary data used above.  To conduct this, we will use a time series model.  Specifically, our machine learning model will use the AutoRegressive Integrated Moving Average (ARIMA).  Remember that outliers can drive inconsistencies in our data model, so we want to ensure that our model is within tolerance for most of our data. For this backtesting and forecasting this model we will use a data prediction tolerance of +/- 1 point or 1000 basis points of the original data

   Create a table with all the variables needed.
   
```{r warning = FALSE, message= FALSE, include= FALSE}
Inflation_Model <- tibble(All_Fed$Year,
                       All_Fed$`Inflation Rate YoY`
)
colnames(Inflation_Model)<- c("Years", "Inflation_YoY")
Inflation_Model
```
```{r warning = FALSE, message= FALSE, echo = FALSE}
ggplot(Inflation_Model,aes(x = Years, y = Inflation_YoY )) +
  geom_point(shape =21,
             color = "black",
             fill = "darksalmon",
             size = 4) +
  theme_classic() +
  labs(
    title = " Inflation Rate YoY (1929-2017)",
    subtitle = "HardvardX Capstone Project 2022",
    caption = "Portions of this data is from 1951-2017 and the Reference Section.",
    x = "Years",
    y = "Inflation Rate YoY (%)",
  ) +
  theme_bw()+
  theme(
        plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        plot.caption = element_text(face = "italic", hjust = 0.5))+
  scale_x_continuous(breaks = c(1925, 1935, 1945, 1955, 1965, 1975, 1985, 1995, 2005, 2015, 2025))+
  scale_y_continuous(breaks = c(-20, -15, -10, -5, 0, 5, 10, 15, 20))
```
&nbsp;  

  As you can see, the data is scattered about.  To use the ARIMA model, we will need to verify the data and see if it is in a time series format.
    
```{r warning = FALSE, message= FALSE}
class(Inflation_Model)
```
&nbsp;  
  
  Its not so lets convert it
    
```{r warning = FALSE, message= FALSE}
Inflation_Model_Time = ts(Inflation_Model$Inflation_YoY, start = min(Inflation_Model$Years), end = max(Inflation_Model$Years), frequency = 1)

class(Inflation_Model_Time)
```
```{r warning = FALSE, message= FALSE, echo = FALSE}
ggplot(data = Inflation_Model_Time)+
  geom_line(aes(colour = after_stat(ifelse(y > 0, "positve", "negative")))) +
  theme_classic() +
  labs(
    title = " Inflation Rate YoY (1929-2017)",
    subtitle = "HardvardX Capstone Project 2022",
    caption = "Portions of this data is from 1951-2017 and the Reference Section.",
    x = "Years",
    y = "Inflation Rate YoY (%)",
  ) +
  theme_bw()+
  theme(legend.title=element_blank(),
        legend.position = 'bottom',
        legend.text = element_text(size = 14),
        plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        plot.caption = element_text(face = "italic", hjust = 0.5))+
  scale_x_continuous(breaks = c(1925, 1935, 1945, 1955, 1965, 1975, 1985, 1995, 2005, 2015))+
  scale_y_continuous(breaks = c(-20, -15, -10, -5, 0, 5, 10, 15, 20))+
  annotate("segment", x = 1928, xend = 2017, y = 0, yend = 0,
         colour = "green4")
```
&nbsp;  
   
   Now that we have the data properly formatted, we have to verify if the data is stationary.  Per the Duke research team ("Introduction to ARIMA models," 2019),"A stationary series has no trend, its variations around its mean have a constant amplitude, and it wiggles consistently, i.e., its short-term random time patterns always look the same in a statistical sense.  With that being established, the Armia model requires stationary data to predict future values from older data properly."

In this case, we are using data from 1929-2017.  We will predict ten years from 2018-2028 and backtest the data from 1993-2003.  First, let us backtest the data to find a suitable model to predict future values.  We will do a ten year model from 1993-2003.
  
```{r warning = FALSE, message= FALSE, include= FALSE}
colnames(Inflation_Model)<- c("Years", "Inflation_YoY")

Inflation_Model_1993 <- tibble(Inflation_Model$Years,
                               Inflation_Model$Inflation_YoY)
Inflation_Model_1993
colnames(Inflation_Model_1993)<- c("Years", "Inflation_YoY")

Inflation_Model_1993

Inflation_Model_removeRows <- Inflation_Model_1993[-c(65:89), ]

Inflation_Model_1993_Time = ts(Inflation_Model_removeRows$Inflation_YoY, start = min(Inflation_Model_removeRows$Years), end = max(Inflation_Model_removeRows$Years), frequency = 1)
```
```{r warning = FALSE, message= FALSE, echo = FALSE}
Inflation_Model_1993_Time

ggplot(data = Inflation_Model_1993_Time)+
  geom_line(aes(colour = after_stat(ifelse(y > 0, "positve", "negative")))) +
  theme_classic() +
  labs(
    title = " Inflation Rate YoY (1929-1992)",
    subtitle = "HardvardX Capstone Project 2022",
    caption = "Portions of this data is from 1929-1992 and the Reference Section.",
    x = "Years",
    y = "Inflation Rate YoY (%)",
  ) +
  theme_bw()+
  theme(legend.title=element_blank(),
        legend.position = 'bottom',
        legend.text = element_text(size = 14),
        plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        plot.caption = element_text(face = "italic", hjust = 0.5))+
  scale_x_continuous(breaks = c(1925, 1935, 1945, 1955, 1965, 1975, 1985, 1995))+
  scale_y_continuous(breaks = c(-20, -15, -10, -5, 0, 5, 10, 15, 20))+
  annotate("segment", x = 1928, xend = 1995, y = 0, yend = 0,
           colour = "green4")
```
&nbsp;  
  
   Verify the data using Auto-Correlation Function (ACF)
   
```{r warning = FALSE, message= FALSE}
acf(Inflation_Model_1993_Time)
```
&nbsp;  
   
  ACF shows us similarities over time using lagged data in a time series.  
The autocorrelations within the blue upper and lower limits are considered significant.  The insignificant autocorrelations exceed the blue upper and lower limits.  In this ACF data plot, more data units pass the blue upper line, indicating that the data is not as stationary.  Lag is a specific period of time; we will reference the lag with a number, i.e., lag 1.

   Verify the data using Partial Auto-Correlation Function (PACF)
   
```{r warning = FALSE, message= FALSE}
pacf(Inflation_Model_1993_Time)
```
&nbsp;  
   
  The PACF data is measured by extracting the effects of any shorter lag correlations.  In an ARIMA model, PACF can pinpoint the number of autoregression coefficients.  PACF test is another verification that the data is not stationary due to the spikes in data that passed the blue upper and lower lines.

  Our final verification will be the Augmented Dickey-Fuller Test.  This test will determine whether the model data is stationary or nonstationary. P value if less than .05 means it is statistically significant.

   Augmented Dickey–Fuller Test
   
```{r warning = FALSE, message= FALSE}
adf.test(Inflation_Model_1993_Time)
```
&nbsp;  
   
  Our P-Value of .18 (18%) is well above our minimum of .05 (5%).  This means we have to alter our confidence level to 82.  The ARIMA model we will use comprises three principles.  P is the total amount of autoregressive terms, D is the amount of non-seasonal differences needed for the data to remain stationary, and	Q is the amount of lagged forecasting errors in the prediction equation.  This format is mirrored in the ARIMA (p,d,q).  Selecting the correct ARIMA (p,d,q) is critical for this forecasting model.  Null Hypothesis means autocorrelation does not exist, and Alternate Hypothesis means autocorrelation does not exist.
  
```{r warning = FALSE, message= FALSE}
True_Inflation_Model_1993= auto.arima(Inflation_Model_1993_Time, ic="aic", trace= TRUE) 
```
&nbsp;  
   
   The best ARIMA for our model will be ARIMA(3,1,0), verify that the data is stationary and smoothed
   
```{r warning = FALSE, message= FALSE}
acf(ts(True_Inflation_Model_1993$residuals))
pacf(ts(True_Inflation_Model_1993$residuals))
```
&nbsp;  
   
  Now that the data is smoothed and fits our current ARIMA model, let us forecast what inflation would be in 10 years starting from 1993.  **Note:** *h = the number of years in the future.  Level 82 = the confidence level for our model.* 
  
```{r warning = FALSE, message= FALSE}
True_Inflation_Model_1993
Inflation_Model_Forecast_1993 = forecast(True_Inflation_Model_1993, level = c(95), h = 11)
```
&nbsp;  
   
   Lets validate the data using the Ljung Box.test to verify that the residuals are not just "white noise"
   
```{r warning = FALSE, message= FALSE}
Box.test(Inflation_Model_Forecast_1993, lag = 1, type = "Ljung-Box")
```
&nbsp;  
  
   If the P value is less than .05 that means that the data has autocorrelation significance with a 95% confidence level.
   
```{r warning = FALSE, message= FALSE}
Box.test(Inflation_Model_Forecast_1993, lag = 5, type = "Ljung-Box")
```
&nbsp;  
   
   Lets see the results and chart it
   

```{r warning = FALSE, message= FALSE, results= "hide"}
Inflation_Model_1993_2003 = auto.arima(Inflation_Model_1993_Time, ic="aic", trace= TRUE,) 

Backtest_Inflation_Model_Forecast = forecast(Inflation_Model_1993_2003 , level = c(95), h = 11)
```

```{r warning = FALSE, message= FALSE, results= "hide"}
Backtest_Inflation_Model_Forecast
```

```{r warning = FALSE, message= FALSE, echo = FALSE}
autoplot(Backtest_Inflation_Model_Forecast, ts.colour = 'coral', predict.colour = 'black', predict.linetype = 'dashed', conf.int = TRUE, conf.int.linetype = "dashed", conf.int.fill = "azure")+
  annotate("text", x = 1999, y = 17, label = "Hi 82% Conf.",  size = 3, color = "blue")+
  annotate("text", x = 1999, y = -9.5, label = "Low 82% Conf.",  size = 3, color = "blue")+
  theme_classic() +
  labs(
    title = " Backtest Model Inflation Rate YoY (1993-2003)",
    subtitle = "HardvardX Capstone Project 2022",
    caption = "Portions of this data is from 1929-1992 and the Reference Section.",
    x = "Years",
    y = "Inflation Rate YoY (%)",
  ) +
  theme_bw()+
  theme(
        plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        plot.caption = element_text(face = "italic", hjust = 0.5))
```
&nbsp;  
   
   Let's examine how many years are within +/- 1000 basis points of the original Fed Data object Inflation_Model.
   
```{r warning = FALSE, message= FALSE, echo = FALSE, results= "hide"}
Compare_One <- Inflation_Model[-c(1:64, 76:89),]
Inflation_Model_One<- c(3.1, 4.7, 4.4, 3.8, 3.2, 3.7, 4.1, 4.2, 3.8, 3.6, 3.7)
Compare_One$new_col <- Inflation_Model_One
Compare_One
colnames(Compare_One)<- c("Year", "Inflation_YoY", "Model_Inflation_YoY_One")
Inflation_Model_Diff_One<- c(Compare_One$Model_Inflation_YoY_One -Compare_One$Inflation_YoY)
Compare_One$new_col <- Inflation_Model_Diff_One
colnames(Compare_One)<- c("Year", "Inflation_YoY", "Model_Inflation_YoY_One", "Predict_Diff")
Compare_One

Good1<- Compare_One$Predict_Diff<=1
length(Good1[Good1== TRUE])
length(Good1[Good1== FALSE])
Compare_One$new_col <- Good1
colnames(Compare_One)<- c("Year", "Inflation_YoY", "Model_Inflation_YoY_One", "Predict_Diff", "Within_Tolerance")
Compare_One
```
```{r warning = FALSE, message= FALSE, echo = FALSE}
cpo<- Compare_One %>%
  gt() %>%
  tab_header(
    title = md("**Inflation Rate Year over Year Model**"),
    subtitle = md("HardvardX Capstone Project 2022")
  ) %>%
  cols_width(
    everything() ~ px(160)) %>%
  tab_source_note(
    source_note = md("Portions of this data is from the Reference Section")
  ) %>%
  tab_footnote(
    footnote = md("  Inflation Rate YoY is based on data from 1993-2003  ")
  ) %>%
  opt_table_font(
    font = "Times New Roman",
    weight = 300) %>%
  cols_align(
    align = "center",
    columns = everything()
  )  %>%
  tab_style(
    style = list(
      cell_fill(color = "green"),
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Within_Tolerance,
      rows = (Within_Tolerance >= TRUE)
    )
  ) %>%
  tab_style(
    style = list(
      cell_fill(color = "red"),
      cell_text(style = "italic")
    ),
    locations = cells_body(
      columns = Within_Tolerance,
      rows = (Within_Tolerance <= FALSE)
    ))
```
![](/Library/Frameworks/R.framework/Versions/4.2/images/cpo.png)

&nbsp;  
    
  The model has more false results than true. This data is nearly double the inflation rate based on our historical data. We have to make several adjustments moving forward. Let us view the backtest model vs actual data chart.

   Compare Chart
   
```{r warning = FALSE, message= FALSE, echo = FALSE}
autoplot(Backtest_Inflation_Model_Forecast, ts.colour = 'coral', predict.colour = 'black', predict.linetype = 'dashed', conf.int = TRUE, conf.int.linetype = "dashed", conf.int.fill = "azure")+
  annotate("text", x = 1999, y = 17, label = "Hi 82% Conf.",  size = 3, color = "blue")+
  annotate("text", x = 1999, y = -9.5, label = "Low 82% Conf.",  size = 3, color = "blue")+
  theme_classic() +
  labs(
    title = " Backtest Model Inflation Rate YoY (1993-2003)",
    subtitle = "HardvardX Capstone Project 2022",
    caption = "Portions of this data is from 1929-2003 and the Reference Section.",
    x = "Years",
    y = "Inflation Rate YoY (%)",
  ) +
  theme_bw()+
  theme(
        plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        plot.caption = element_text(face = "italic", hjust = 0.5))+
  annotate("segment", x = 1992, xend = 1993, y = 2.9, yend = 2.7,
           colour = "coral")+
  annotate("segment", x = 1993, xend = 1994, y = 2.7, yend = 2.7,
         colour = "coral")+
  annotate("segment", x = 1994, xend = 1995, y = 2.7, yend = 2.5,
           colour = "coral")+
  annotate("segment", x = 1995, xend = 1996, y = 2.5, yend = 3.3,
           colour = "coral")+
  annotate("segment", x = 1996, xend = 1997, y = 3.3, yend = 1.7,
           colour = "coral")+
  annotate("segment", x = 1997, xend = 1998, y = 1.7, yend = 1.6,
           colour = "coral")+
  annotate("segment", x = 1998, xend = 1999, y = 1.6, yend = 2.7,
           colour = "coral")+
  annotate("segment", x = 1999, xend = 2000, y = 2.7, yend = 3.4,
           colour = "coral")+
  annotate("segment", x = 2000, xend = 2001, y = 3.4, yend = 1.6,
           colour = "coral")+
  annotate("segment", x = 2001, xend = 2002, y = 1.6, yend = 2.4,
           colour = "coral")+
  annotate("segment", x = 2002, xend = 2003, y = 2.4, yend = 1.9,
           colour = "coral")+
  annotate("text", x = 1970, y = -12, label = "Actual YoY Rate", color = "coral")+
  annotate("text", x = 1970, y = -13, label = "Model YoY Rate", color = "black")+
  annotate("text", x = 1970, y = -11, label = "LEGEND", size = 4, color = "black")
```
&nbsp;  
   
  Let's adjust the arima(p,d,q), review and update our P-Value.
    
```{r warning = FALSE, message= FALSE, results= "hide"}
Inflation_Model_1993_2003 = arima(fixed = NULL, Inflation_Model_1993_Time, order = c(6,2,1), transform.pars=TRUE)

Backtest_Inflation_Model_Forecast_1 = forecast(Inflation_Model_1993_2003, level = c(82), h = 11)

Backtest_Inflation_Model_Forecast_1
```
   
   Verify our model by running check residual and update the conf. This is a series of diagnostic tests that we will use to validate our model (Long, 2019).
   
```{r warning = FALSE, message= FALSE}
checkresiduals(Backtest_Inflation_Model_Forecast_1)

Backtest_Inflation_Model_Forecast_1 = forecast(Inflation_Model_1993_2003, level = c(87), h = 11)
```
&nbsp;  

  *__Great improvement__*.  
  
Per (Long, 2019), to verify check residuals, we should look for the following:

1. Do the standardized residuals show volatility clusters?  
    * If so, readjust the model.  
2. Does the ACF show significant autocorrelation between the residuals?
    * If so, readjust the model. 
3. Do the residuals look bell-shaped?  
    * If so, this suggests they are reasonably symmetrical.  
4. Are the p-value in the Ljung–Box test extensive?  
    * If so, this indicates the residuals are patternless meaning the model has extracted all the information, and the only noise is left behind. 
   
Let us compare the data and adjust the confidence level to 87% based on the new P-Value of .13 (13%).  [^4]  

[^4]: ***Correction: row 3 (1995) should be FALSE***
    
```{r warning = FALSE, message= FALSE, include= FALSE}
Compare_Two <- Inflation_Model[-c(1:64, 76:89),]
Inflation_Model_One<- c(1.6, 3.7, 3.7, 3.2, 2.2, 1.9, 2.3, 2.0, 2.0, 1.5, 1.5)
Compare_Two$new_col <- Inflation_Model_One
Compare_Two
colnames(Compare_Two)<- c("Year", "Inflation_YoY", "Model_Inflation_YoY")
Inflation_Model_Diff<- c(Compare_Two$Inflation_YoY-Compare_Two$Model_Inflation_YoY)
Compare_Two$new_col <- Inflation_Model_Diff
colnames(Compare_Two)<- c("Year", "Inflation_YoY", "Model_Inflation_YoY", "Predict_Diff")
Compare_Two

Good2<- Compare_Two$Predict_Diff<= 1
length(Good2[Good2== TRUE])
length(Good2[Good2== FALSE])

Compare_Two$new_col <- Good2
colnames(Compare_Two)<- c("Year", "Inflation_YoY", "Model_Inflation_YoY", "Predict_Diff", "Within_Tolerance")
Compare_Two
```
```{r warning = FALSE, message= FALSE, echo = FALSE}
cpt<- Compare_Two %>%
  gt() %>%
  tab_header(
    title = md("**Inflation Rate Year over Year Model**"),
    subtitle = md("HardvardX Capstone Project 2022")
  ) %>%
  cols_width(
    everything() ~ px(160)) %>%
  tab_source_note(
    source_note = md("Portions of this data is from the Reference Section")
  ) %>%
  tab_footnote(
    footnote = md("  Inflation Rate YoY is based on data from 1993-2003  ")
  ) %>%
  opt_table_font(
    font = "Times New Roman",
    weight = 300) %>%
  cols_align(
    align = "center",
    columns = everything()
  )  %>%
  tab_style(
    style = list(
      cell_fill(color = "green"),
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Within_Tolerance,
      rows = (Within_Tolerance >= TRUE)
    )
  ) %>%
  tab_style(
    style = list(
      cell_fill(color = "red"),
      cell_text(style = "italic")
    ),
    locations = cells_body(
      columns = Within_Tolerance,
      rows = (Within_Tolerance <= FALSE)
    ))
```
![](/Library/Frameworks/R.framework/Versions/4.2/images/cpt.png)

&nbsp;  
  
  *__Amazing!__* Our model is now closer to our goal. 
Let us view it in a chart.
  
```{r warning = FALSE, message= FALSE, echo = FALSE}
autoplot(Backtest_Inflation_Model_Forecast_1, ts.colour = 'coral', predict.colour = 'black', predict.linetype = 'dashed', conf.int = TRUE, conf.int.linetype = "dashed", conf.int.fill = "azure")+
  annotate("text", x = 2003, y = 15, label = "HI 87% Conf.",  size = 3, color = "blue")+
  annotate("text", x = 2003, y = -12, label = "Low 87% Conf.",  size = 3, color = "blue")+
  theme_classic() +
  labs(
    title = " Final Model Inflation Rate YoY (1993-2003)",
    subtitle = "HardvardX Capstone Project 2022",
    caption = "Portions of this data is from 1929-1992 and the Reference Section.",
    x = "Years",
    y = "Inflation Rate YoY (%)",
  ) +
  theme_bw()+
  theme(
    plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
    plot.subtitle = element_text(hjust = 0.5),
    plot.caption = element_text(face = "italic", hjust = 0.5))+
  annotate("segment", x = 1992, xend = 1993, y = 3, yend = 2.7,
           colour = "coral")+
  annotate("segment", x = 1993, xend = 1994, y = 2.7, yend = 2.7,
           colour = "coral")+
  annotate("segment", x = 1994, xend = 1995, y = 2.7, yend = 2.5,
           colour = "coral")+
  annotate("segment", x = 1995, xend = 1996, y = 2.5, yend = 3.3,
           colour = "coral")+
  annotate("segment", x = 1996, xend = 1997, y = 3.3, yend = 1.7,
           colour = "coral")+
  annotate("segment", x = 1997, xend = 1998, y = 1.7, yend = 1.6,
           colour = "coral")+
  annotate("segment", x = 1998, xend = 1999, y = 1.6, yend = 2.7,
           colour = "coral")+
  annotate("segment", x = 1999, xend = 2000, y = 2.7, yend = 3.4,
           colour = "coral")+
  annotate("segment", x = 2000, xend = 2001, y = 3.4, yend = 1.6,
           colour = "coral")+
  annotate("segment", x = 2001, xend = 2002, y = 1.6, yend = 2.4,
           colour = "coral")+
  annotate("segment", x = 2002, xend = 2003, y = 2.4, yend = 1.9,
           colour = "coral")+
  annotate("text", x = 1970, y = -13.5, label = "Actual YoY Rate", color = "coral")+
  annotate("text", x = 1970, y = -12.5, label = "Model YoY Rate", color = "black")+
  annotate("text", x = 1970, y = -10.5, label = "LEGEND", size = 4, color = "black")
```
&nbsp;  
    
  Now that we have a great model we created when we backtested the data, let us create a model that can predict future values of the Inflation Rate YoY.

   Verify the data 
   
```{r warning = FALSE, message= FALSE}
acf(Inflation_Model_Time)

pacf(Inflation_Model_Time)

adf.test(Inflation_Model_Time)
```
&nbsp;  
   
   Utilize the ARIMA from our backtest model
   
```{r warning = FALSE, message= FALSE}
True_Inflation_Model = arima(fixed = NULL, Inflation_Model_Time, order = c(6,2,1), transform.pars=TRUE)

True_Inflation_Model
```
&nbsp;  
  
   verify that the data is stationary and smoothed
   
```{r warning = FALSE, message= FALSE}
acf(ts(True_Inflation_Model$residuals))
pacf(ts(True_Inflation_Model$residuals))
```
&nbsp;  
   
  Now that the data is smoothed and fits our current ARIMA model lets forecast what inflation would be in 10 years starting from 2018.  
    
```{r warning = FALSE, message= FALSE}
True_Inflation_Model

Inflation_Model_Forecast = forecast(True_Inflation_Model, level = c(81), h = 11)

Inflation_Model_Forecast
```
&nbsp;  
  
   Verify Model
   
```{r warning = FALSE, message= FALSE}
checkresiduals(Inflation_Model_Forecast)
```
&nbsp;  
   
   Lets update the confidence level to 90% since the P Value is .10 (10%)
   
```{r warning = FALSE, message= FALSE}
Inflation_Model_Forecast_Update = forecast(True_Inflation_Model, level = c(90), h = 11)

Inflation_Model_Forecast_Update
```
```{r warning = FALSE, message= FALSE, echo = FALSE}
autoplot(Inflation_Model_Forecast_Update, ts.colour = 'coral', predict.colour = 'black', predict.linetype = 'dashed', conf.int = TRUE, conf.int.linetype = "dashed", conf.int.fill = "azure")+
  annotate("text", x = 2027, y = 14, label = "Hi 90% Conf.",  size = 3, color = "blue")+
  annotate("text", x = 2027, y = -13, label = "Low 90%% Conf.",  size = 3, color = "blue")+
  theme_classic() +
  labs(
    title = " Future Model: Inflation Rate YoY (2018-2028)",
    subtitle = "HardvardX Capstone Project 2022",
    caption = "Portions of this data is from 1929-2017 and the Reference Section.",
    x = "Years",
    y = "Inflation Rate YoY (%)",
  ) +
  theme_bw()+
  theme(
    plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
    plot.subtitle = element_text(hjust = 0.5),
    plot.caption = element_text(face = "italic", hjust = 0.5))
```
&nbsp;  
    
  Let us create a Federal Reserve's Fed Funds Rate model to predict the future rate and backtest prior data. Create a table with all the variables needed.
  
```{r warning = FALSE, message= FALSE, include= FALSE}
Fed_Model <- tibble(All_Fed$Year,
                          All_Fed$`Fed Funds Rate`
)
Fed_Model
colnames(Fed_Model)<- c("Years", "Fed_Fund_Rate")

Fed_Model
```
```{r warning = FALSE, message= FALSE, echo = FALSE}
ggplot(Fed_Model,aes(x = Years, y = Fed_Fund_Rate )) +
  geom_point(shape =21,
             color = "black",
             fill = "darkslategray1",
             size = 4) +
  theme_classic() +
  labs(
    title = " Federal Reserve's Fund Rate (1929-2017)",
    subtitle = "HardvardX Capstone Project 2022",
    caption = "Portions of this data is from 1929-2017 and the Reference Section.",
    x = "Years",
    y = "Federal Reserve's Fund Rate",
  ) +
  theme_bw()+
  theme(
        plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        plot.caption = element_text(face = "italic", hjust = 0.5))+
  scale_x_continuous(breaks = c(1925, 1935, 1945, 1955, 1965, 1975, 1985, 1995, 2005, 2015, 2025))+
  scale_y_continuous(breaks = c(-20, -15, -10, -5, 0, 5, 10, 15, 20))
```
&nbsp;  
    
  Verify the Model and see if its in a Time Series
    
```{r warning = FALSE, message= FALSE}
class(Fed_Model)
```
&nbsp;  
  
  Its not so lets convert it
  
```{r warning = FALSE, message= FALSE, include= FALSE}
Fed_Model_Time = ts(Fed_Model$Fed_Fund_Rate, start = min(Fed_Model$Years), end = max(Fed_Model$Years), frequency = 1)

class(Fed_Model_Time)
```
```{r warning = FALSE, message= FALSE, echo = FALSE}
ggplot(data = Fed_Model_Time)+
  geom_line(aes(colour = after_stat(ifelse(y > 3.67, "above average", "below average")))) +
  theme_classic() +
  labs(
    title = " Federal Reserve's Fed Fund Rate (1929-2017)",
    subtitle = "HardvardX Capstone Project 2022",
    caption = "Portions of this data is from 1929-2017 and the Reference Section. 
    The Federal Funds Rate Average is 3.67.",
    x = "Years",
    y = "Fed Fund Rate (%)",
  ) +
  theme_bw()+
  theme(legend.title=element_blank(),
        legend.position = 'bottom',
        legend.text = element_text(size = 14),
        plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        plot.caption = element_text(face = "italic", hjust = 0.5))+
  scale_x_continuous(breaks = c(1925, 1935, 1945, 1955, 1965, 1975, 1985, 1995, 2005, 2015))+
  scale_y_continuous(breaks = c(-20, -15, -10, -5, 0, 5, 10, 15, 20))+
  annotate("segment", x = 1928, xend = 2017, y = 0, yend = 0,
           colour = "lightsalmon4")
```
&nbsp;  
    
  Create a Backtest model
  
```{r warning = FALSE, message= FALSE, include= FALSE}
Fed_Model_Forecast_1993 <- tibble(Fed_Model$Years,
                                  Fed_Model$Fed_Fund_Rate)
Fed_Model_Forecast_1993
colnames(Fed_Model_Forecast_1993)<- c("Years", "Fed_Rate")

Fed_Model_Forecast_1993

Fed_Model_Forecast_removerows <- Fed_Model_Forecast_1993[-c(65:89), ]

Fed_Model_1993_Time = ts(Fed_Model_Forecast_removerows$Fed_Rate, start = min(Fed_Model_Forecast_removerows$Years), end = max(Fed_Model_Forecast_removerows$Years), frequency = 1)
```
```{r warning = FALSE, message= FALSE}
adf.test(Fed_Model_1993_Time)

Fed_Model_1993_2003 = auto.arima(Fed_Model_1993_Time, ic="aic", trace= TRUE,) 

Backtest_Fed_Model_Forecast = forecast(Fed_Model_1993_2003, level = c(58), h = 11)

Backtest_Fed_Model_Forecast
```
&nbsp;  
   
   Verify Model
   
```{r warning = FALSE, message= FALSE}
checkresiduals(Backtest_Fed_Model_Forecast)
```
&nbsp;  

   Chart the Model
   
```{r warning = FALSE, message= FALSE, echo = FALSE}
autoplot(Backtest_Fed_Model_Forecast, ts.colour = 'darkgoldenrod', predict.colour = 'black', predict.linetype = 'dashed', conf.int = TRUE, conf.int.linetype = "dashed", conf.int.fill = "azure")+
  annotate("text", x = 1999, y = 17, label = "HI 95% Conf.",  size = 3, color = "blue")+
  annotate("text", x = 1999, y = -9.5, label = "Low 95% Conf.",  size = 3, color = "blue")+
  theme_classic() +
  labs(
    title = " Backtest Model Federal Reserve's Federal Fund's Rate (1993-2003)",
    subtitle = "HardvardX Capstone Project 2022",
    caption = "Portions of this data is from 1929-1992 and the Reference Section.",
    x = "Years",
    y = "Federal Funds Rate (%)",
  ) +
  theme_bw()+
  theme(
    plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
    plot.subtitle = element_text(hjust = 0.5),
    plot.caption = element_text(face = "italic", hjust = 0.5))
```
&nbsp;  
   
   This backtest model is only computing the value 3 as a prediction. We want the prediction within 1 point (1000 basis points) of the original Fed Model object Fed_Fund_Rate.  After viewing the results from check residuals, we noticed that the data didn't check all the boxes referenced above and P-Value is .71 (71%) which gives us a confidence level of 29%.  Let's manually select the ARIMA.
   
```{r warning = FALSE, message= FALSE}
adf.test(Fed_Model_1993_Time)

Fed_Model_1993_2003 = arima(fixed = NULL, Fed_Model_1993_Time, order = c(5,1,6),  transform.pars=TRUE)

Backtest_Fed_Model_Forecast_Update = forecast(Fed_Model_1993_2003, level = c(30), h = 11)

Backtest_Fed_Model_Forecast_Update
```
&nbsp;  
   
   Verify Model
   
```{r warning = FALSE, message= FALSE}
checkresiduals(Backtest_Fed_Model_Forecast_Update)
```
&nbsp;  
   
   Let's update our conf levels to 92% based on our new p value.
   
```{r warning = FALSE, message= FALSE}
Backtest_Fed_Model_Forecast_Update = forecast(Fed_Model_1993_2003, level = c(92), h = 11)

Backtest_Fed_Model_Forecast_Update
```
&nbsp;  
   
   Chart the Data
   
```{r warning = FALSE, message= FALSE, echo = FALSE}
autoplot(Backtest_Fed_Model_Forecast_Update, ts.colour = 'darkgoldenrod', predict.colour = 'black', predict.linetype = 'dashed', conf.int = TRUE, conf.int.linetype = "dashed", conf.int.fill = "azure")+
  annotate("text", x = 1999, y = 17, label = "HI 92% Conf.",  size = 3, color = "blue")+
  annotate("text", x = 1999, y = -9.5, label = "Low 92% Conf.",  size = 3, color = "blue")+
  theme_classic() +
  labs(
    title = " Backtest Model Federal Reserve's Federal Fund's Rate (1993-2003)",
    subtitle = "HardvardX Capstone Project 2022",
    caption = "Portions of this data is from 1929-1992 and the Reference Section.",
    x = "Years",
    y = "Federal Funds Rate (%)",
  ) +
  theme_bw()+
  theme(
    plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
    plot.subtitle = element_text(hjust = 0.5),
    plot.caption = element_text(face = "italic", hjust = 0.5))
```
   
```{r warning = FALSE, message= FALSE, include= FALSE}
Compare_Fed <- Fed_Model[-c(1:64, 76:89),]
Fed_Model_One<- c(3.7, 4.6, 5, 4.9, 5.4, 5, 4.5, 4.3, 4.5, 4.3, 4.5)
Compare_Fed$new_col <- Fed_Model_One
Compare_Fed
colnames(Compare_Fed)<- c("Year", "Original_Fed_Rate", "Model_Fed_Fund_Rate")
Compare_Fed
Compare_Fed_Model_Diff_One<- c(Compare_Fed$Model_Fed_Fund_Rate -Compare_Fed$Original_Fed_Rate)
Compare_Fed$new_col <- Compare_Fed_Model_Diff_One
colnames(Compare_Fed)<- c("Year", "Original_Fed_Rate", "Model_Fed_Fund_Rate", "Fed_Diff")
Compare_Fed
```
&nbsp;  

  Verify if the model works by using true/false rubric with basis point tolerance .[^5]
    
```{r warning = FALSE, message= FALSE, include= FALSE}
GoodFed<- Compare_Fed$Fed_Diff<=1
length(GoodFed[GoodFed== TRUE])
length(GoodFed[GoodFed== FALSE])

Compare_Fed$new_col <- GoodFed
colnames(Compare_Fed)<- c("Year", "Original_Fed_Rate", "Model_Fed_Fund_Rate", "Fed_Diff", "Within_Tolerance")
```
```{r warning = FALSE, message= FALSE, echo = FALSE}
cpf <- Compare_Fed %>%
  gt() %>%
  tab_header(
    title = md("**Federal Reserve's Fed Fund Rate Model**"),
    subtitle = md("HardvardX Capstone Project 2022")
  ) %>%
  cols_width(
    everything() ~ px(160)) %>%
  tab_source_note(
    source_note = md("Portions of this data is from the Reference Section")
  ) %>%
  tab_footnote(
    footnote = md("  Fed Funds Rate is based on data from 1993-2003  ")
  ) %>%
  opt_table_font(
    font = "Times New Roman",
    weight = 300) %>%
  cols_align(
    align = "center",
    columns = everything()
  )  %>%
  tab_style(
    style = list(
      cell_fill(color = "green"),
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Within_Tolerance,
      rows = (1:8)
    )
  ) %>%
  tab_style(
    style = list(
      cell_fill(color = "red"),
      cell_text(style = "italic")
    ),
    locations = cells_body(
      columns = Within_Tolerance,
      rows = (9:11)
    ))
```
![](/Library/Frameworks/R.framework/Versions/4.2/images/cpf.png)

&nbsp;  
   
   [^5]: ***Correction: Row 8 (2000) should be FALSE.***
   
   Create chart with Backtest Model Federal Funds Rate vs Actual Federal Funds Rate (1993-2003).
   
```{r warning = FALSE, message= FALSE, echo = FALSE}
autoplot(Backtest_Fed_Model_Forecast_Update, ts.colour = 'darkgoldenrod', predict.colour = 'black', predict.linetype = 'dashed', conf.int = TRUE, conf.int.linetype = "dashed", conf.int.fill = "azure")+
  annotate("text", x = 2003, y = 12, label = "HI 92% Conf.",  size = 3, color = "blue")+
  annotate("text", x = 2003, y = -3, label = "Low 92% Conf.",  size = 3, color = "blue")+
  theme_classic() +
  labs(
    title = " Backtest Model vs Actual Federal Funds Rate (1993-2003)",
    subtitle = "HardvardX Capstone Project 2022",
    caption = "Portions of this data is from 1929-2017 and the Reference Section.",
    x = "Years",
    y = "Federal Fund's Rate (%)",
  ) +
  theme_bw()+
  theme(
    plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
    plot.subtitle = element_text(hjust = 0.5),
    plot.caption = element_text(face = "italic", hjust = 0.5))+
  annotate("segment", x = 1992, xend = 1993, y = 3, yend = 3,
           colour = "darkgoldenrod")+
  annotate("segment", x = 1993, xend = 1994, y = 3, yend = 5.5,
           colour = "darkgoldenrod")+
  annotate("segment", x = 1994, xend = 1995, y = 5.5, yend = 5.5,
           colour = "darkgoldenrod")+
  annotate("segment", x = 1995, xend = 1996, y = 5.5, yend = 5.3,
           colour = "darkgoldenrod")+
  annotate("segment", x = 1996, xend = 1997, y = 5.3, yend = 5.5,
           colour = "darkgoldenrod")+
  annotate("segment", x = 1997, xend = 1998, y = 5.5, yend = 4.8,
           colour = "darkgoldenrod")+
  annotate("segment", x = 1998, xend = 1999, y = 4.8, yend = 5.5,
           colour = "darkgoldenrod")+
  annotate("segment", x = 1999, xend = 2000, y = 5.5, yend = 6.5,
           colour = "darkgoldenrod")+
  annotate("segment", x = 2000, xend = 2001, y = 6.5, yend = 1.8,
           colour = "darkgoldenrod")+
  annotate("segment", x = 2001, xend = 2002, y = 1.8, yend = 1.3,
           colour = "darkgoldenrod")+
  annotate("segment", x = 2002, xend = 2003, y = 1.3, yend = 1,
           colour = "darkgoldenrod")+
  annotate("text", x = 1970, y = -4.5, label = "Actual Fed Rate", color = "darkgoldenrod")+
  annotate("text", x = 1970, y = -3.5, label = "Model Fed Rate", color = "black")+
  annotate("text", x = 1970, y = -2.0, label = "LEGEND", size = 4, color = "black")
```
&nbsp;  
   
   As we can see the majority of the rates are within our model. In the Year 2000, the U.S. Economy experienced the Dot.com crash. That recessionary event caused the Federal Reserve to cut rates which explains why rates crashed downward.  

  Create Future Fed Rates Model
  
```{r warning = FALSE, message= FALSE}
Fed_Model_True = arima(fixed = NULL, transform.pars=TRUE, Fed_Model_Time, order = c(5,1,6))
Fed_Model_Forecast = forecast(Fed_Model_True, level = c(95), h = 11)
Fed_Model_Forecast
```
&nbsp;  
   
   Verify Data
   
```{r warning = FALSE, message= FALSE}
Box.test(Fed_Model_Forecast, lag = 1, type = "Ljung-Box")

Box.test(Fed_Model_Forecast, lag = 5, type = "Ljung-Box")

checkresiduals(Fed_Model_Forecast)
```
&nbsp;  
   
   Chart Data
   
```{r warning = FALSE, message= FALSE, echo = FALSE}
autoplot(Fed_Model_Forecast, ts.colour = 'darkgoldenrod', predict.colour = 'black', predict.linetype = 'dashed', conf.int = TRUE, conf.int.linetype = "dashed", conf.int.fill = "azure")+
  annotate("text", x = 2025, y = 9, label = "Hi 95% Conf.",  size = 3, color = "blue")+
  annotate("text", x = 2025, y = -7, label = "Low 95% Conf.",  size = 3, color = "blue")+
  theme_classic() +
  labs(
    title = " Future Model: Federal Reserve's Federal Fund's Rate (2018-2028)",
    subtitle = "HardvardX Capstone Project 2022",
    caption = "Portions of this data is from 1929-2017 and the Reference Section.",
    x = "Years (2018-2028)",
    y = "Federal Funds Rate (%)",
  ) +
  theme_bw()+
  theme(
    plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
    plot.subtitle = element_text(hjust = 0.5),
    plot.caption = element_text(face = "italic", hjust = 0.5))
```
&nbsp;  

\newpage

## Results: 

All of our goals where achieved: 

1. We identified the best correlation was a positive correlation with the Federal Funds Rate and Inflation Rate YoY:
    * correlation is ***0.7710506***
    * ***R^2^ of 88%*** this means that ***12%*** of variance is explained by outliers deriving from geopolitical and economic factors instead of unknown factors.
2. For our Inflation Rate YoY Machine Learning Model:
    * We identified the best Model for backtesting had an ***ARIMA (6,2,1) with a 87% confidence level.*** 
    * We identified the best Model for forecasting had an ***ARIMA (6,2,1) with a 90% confidence level.*** 
    * Backtest Code & Forecast Code:  
```{r warning = FALSE, message= FALSE, results="hide"} 
Inflation_Model_1993_2003 = arima(fixed = NULL, Inflation_Model_1993_Time, order = c(6,2,1), transform.pars=TRUE)
Backtest_Inflation_Model_Forecast_1 = forecast(Inflation_Model_1993_2003, level = c(87), h = 11)
```

```{r warning = FALSE, message= FALSE, results="hide"}    
    True_Inflation_Model = arima(fixed = NULL, Inflation_Model_Time, order = c(6,2,1), transform.pars=TRUE)
Inflation_Model_Forecast_Update = forecast(True_Inflation_Model, level = c(90), h = 11)
```
3. For our Federal Reserve Federal Funds Rate Model:
    * We identified the best Model for backtesting had an ***ARIMA (5,1,6) with a 92% confidence level.*** 
    * We identified the best Model for forecasting had an ***ARIMA (5,1,6) with a 95% confidence level.***
    * Backtest Code & Forecast Code: 
```{r warning = FALSE, message= FALSE, results="hide"}     
Fed_Model_1993_2003 = arima(fixed = NULL, Fed_Model_1993_Time, order = c(5,1,6),  transform.pars=TRUE)
Backtest_Fed_Model_Forecast_Update = forecast(Fed_Model_1993_2003, level = c(92), h = 11)
```

```{r warning = FALSE, message= FALSE, results="hide"} 
Fed_Model_True = arima(fixed = NULL, transform.pars=TRUE, Fed_Model_Time, order = c(5,1,6))
Fed_Model_Forecast = forecast(Fed_Model_True, level = c(95), h = 11)
```
&nbsp;  

\newpage

## Conclusion: 
    
  Utilizing Pearson's Correlation Coefficient (r) tool can show how different variables may have zero, inverse or positive correlation.  In this case, we know that economic and geopolitical factors can drive outliers affecting Pearson's Correlation Coefficient (r) calculations by skewing the calculated results. 
    
  Geopolitical and economic outliers can also affect monetary policy, which the Federal Reserve drives.  We can also conclude that the Federal Funds Rate and the Inflation Rate YoY have a positive but moderate correlation between 1929-1950 but a significantly positive correlation from 1951-2017 once the Federal Reserve utilized all the tools required to help fight inflation.
  
  Lastly, adding all these factors into our Machine Learning model proved essential in backtesting and predicting future inflation rates YoY and Fed funds rates.  
